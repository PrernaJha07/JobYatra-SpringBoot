<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerConnect(online Job Portal) - Find Your Dream Job</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Add this to your HTML head section -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --gradient: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --gradient-secondary: linear-gradient(135deg, #f72585 0%, #b5179e 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            min-height: 100vh;
        }
        
        .navbar {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.8rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .nav-link {
            font-weight: 500;
            margin: 0 0.5rem;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover, .nav-link.active {
            background: var(--gradient);
            color: white !important;
            transform: translateY(-2px);
        }
        
        .hero-section {
            background: var(--gradient);
            color: white;
            padding: 100px 0;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="rgba(255,255,255,0.05)" points="0,1000 1000,0 1000,1000"/></svg>');
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
        }
        
        .search-box {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 15px 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .job-card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-bottom: 25px;
            background: white;
            overflow: hidden;
        }
        
        .job-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .company-logo {
            width: 70px;
            height: 70px;
            object-fit: contain;
            border-radius: 15px;
            background: var(--light);
            padding: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .profile-section {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            margin-bottom: 25px;
        }
        
        .profile-photo {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid var(--primary);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }
        
        .status-badge {
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending { 
            background: linear-gradient(135deg, #fff3cd, #ffc107);
            color: #856404;
        }
        .status-success { 
            background: linear-gradient(135deg, #d1edff, #17a2b8);
            color: #055160;
        }
        .status-rejected { 
            background: linear-gradient(135deg, #f8d7da, #dc3545);
            color: #721c24;
        }
        
        .admin-panel {
            background: var(--gradient);
            color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .btn-primary {
            background: var(--gradient);
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
            background: var(--gradient);
        }
        
        .btn-outline-primary {
            border: 2px solid var(--primary);
            border-radius: 50px;
            padding: 10px 25px;
            font-weight: 600;
            color: var(--primary);
            transition: all 0.3s ease;
        }
        
        .btn-outline-primary:hover {
            background: var(--gradient);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        
        .modal-custom {
            border-radius: 20px;
            border: none;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            border-bottom: 1px solid rgba(0,0,0,0.1);
            padding: 25px 30px 15px;
        }
        
        .modal-body {
            padding: 25px 30px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        .section-content {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }
        
        .section-content.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .company-slide {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .company-slide:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .step-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .step-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient);
        }
        
        .step-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .step-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 2rem;
        }
        
        .table-custom {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .table-custom th {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 15px;
            font-weight: 600;
        }
        
        .table-custom td {
            padding: 15px;
            vertical-align: middle;
            border-color: #f1f3f4;
        }

        .cv-preview {
            max-width: 100%;
            max-height: 80vh;
            border: 2px solid #dee2e6;
            border-radius: 10px;
        }

        .jobs-search-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .auto-fill-field {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
        }

        .build-resume-btn {
            background: var(--gradient-secondary);
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(247, 37, 133, 0.3);
        }

        .build-resume-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(247, 37, 133, 0.4);
            color: white;
        }
        
        @media (max-width: 768px) {
            .hero-section {
                padding: 60px 0;
                text-align: center;
            }
            
            .profile-photo {
                width: 120px;
                height: 120px;
            }
            
            .stat-number {
                font-size: 2rem;
            }
        }
        
        
        /* Video Profile Styles */
.video-profile-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 25px;
    color: white;
}

.video-container {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 20px;
    text-align: center;
}

.video-preview {
    width: 100%;
    max-width: 300px;
    border-radius: 15px;
    margin: 0 auto 20px;
    display: block;
}

.video-thumbnail {
    width: 80px;
    height: 80px;
    border-radius: 10px;
    object-fit: cover;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.video-thumbnail:hover {
    transform: scale(1.1);
}

.video-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.video-card {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    padding: 15px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.video-recorder {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    padding: 30px;
    text-align: center;
    margin: 20px 0;
}

.record-btn {
    background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    border: none;
    border-radius: 50%;
    width: 80px;
    height: 80px;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
}

.record-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 15px 30px rgba(255, 107, 107, 0.4);
}

.record-btn.recording {
    background: linear-gradient(135deg, #ff3838, #c23616);
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.timer {
    font-size: 2rem;
    font-weight: bold;
    margin: 20px 0;
    color: #333;
}

.video-preview-container {
    position: relative;
    display: inline-block;
    margin: 20px 0;
}

.delete-video-btn {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #ff4757;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: white;
    cursor: pointer;
    font-size: 0.8rem;
}



/* Admin Video Card Styles */
.video-admin-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid #e9ecef;
}

.video-admin-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.video-thumbnail-wrapper {
    position: relative;
    display: inline-block;
    border-radius: 10px;
    overflow: hidden;
}

.video-thumbnail {
    width: 100%;
    height: 120px;
    object-fit: cover;
    border-radius: 10px;
    cursor: pointer;
    background: #f8f9fa;
}

.video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    cursor: pointer;
    border-radius: 10px;
}

.video-thumbnail-wrapper:hover .video-overlay {
    opacity: 1;
}

.video-overlay i {
    color: white;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

.video-player {
    width: 100%;
    max-height: 400px;
    border-radius: 10px;
}

.stat-item {
    padding: 15px;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 0.9rem;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.user-info {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 8px;
    padding: 15px;
}

.card-header {
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.card-footer {
    border-top: 1px solid rgba(0,0,0,0.05);
}



/* Feedback Button */
.feedback-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--gradient-secondary);
    color: white;
    padding: 15px 20px;
    border-radius: 50px;
    box-shadow: 0 5px 20px rgba(247, 37, 133, 0.4);
    cursor: pointer;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    animation: pulse 2s infinite;
}

.feedback-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(247, 37, 133, 0.6);
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Feedback Cards */
.feedback-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    border-left: 4px solid var(--primary);
}

.feedback-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 10px;
}

.feedback-rating {
    font-size: 1.2em;
}

.feedback-rating-small {
    font-size: 0.9em;
}

.feedback-message {
    color: #555;
    line-height: 1.5;
    margin-bottom: 15px;
}

.feedback-message-preview {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.feedback-photo {
    margin: 10px 0;
}

.feedback-photo img {
    max-width: 200px;
    max-height: 150px;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.3s ease;
}

.feedback-photo img:hover {
    transform: scale(1.05);
}

.feedback-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* Star Rating */
.rating-stars {
    display: flex;
    gap: 5px;
    margin: 15px 0;
}

.rating-stars input {
    display: none;
}

.rating-stars label {
    font-size: 2em;
    color: #ddd;
    cursor: pointer;
    transition: color 0.2s ease;
}

.rating-stars label:hover,
.rating-stars input:checked ~ label {
    color: #ffc107;
}

.rating-stars input:checked ~ label {
    color: #ffc107;
}

/* Photo Preview */
.photo-preview {
    display: none;
    margin-top: 15px;
    text-align: center;
}

.photo-preview img {
    max-width: 200px;
    max-height: 150px;
    border-radius: 10px;
}

/* Feedback Modal */
.feedback-modal-content {
    border-radius: 20px;
    border: none;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

.feedback-modal-header {
    background: var(--gradient);
    color: white;
    border-radius: 20px 20px 0 0 !important;
    border: none;
    padding: 25px 30px 15px;
}

.feedback-modal-body {
    padding: 25px 30px;
}

.feedback-textarea {
    border-radius: 15px;
    border: 2px solid #e9ecef;
    padding: 15px;
    resize: vertical;
    min-height: 120px;
    transition: border-color 0.3s ease;
}

.feedback-textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
}


.feedback-thumbnail {
    max-width: 60px;
    max-height: 60px;
    border-radius: 6px;
    border: 2px solid #dee2e6;
    transition: all 0.3s ease;
}

.feedback-thumbnail:hover {
    border-color: #007bff;
    transform: scale(1.1);
}

.feedback-text-preview {
    max-width: 250px;
    word-wrap: break-word;
    line-height: 1.4;
}

.admin-reply-preview {
    border-left: 4px solid #28a745;
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
}

.btn-group-vertical .btn {
    border-radius: 6px !important;
    margin-bottom: 4px;
}

.table-custom td {
    vertical-align: middle;
    padding: 12px 8px;
}
    </style>
</head>
<body>
    <!-- Navigation Bar (Hidden for Admin) -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top" id="main-navbar">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-rocket me-2"></i>JOB YATRA
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('home')">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('jobs')">
                            <i class="fas fa-briefcase me-1"></i>Jobs
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showProfileSection()">
                            <i class="fas fa-user me-1"></i>Profile
                        </a>
                    </li>
                </ul>
                
                <div class="navbar-nav" id="auth-buttons">
                    <button class="btn btn-outline-primary me-2" onclick="showLoginModal()">
                        <i class="fas fa-sign-in-alt me-1"></i>Login
                    </button>
                    <button class="btn btn-primary" onclick="showSignupModal()">
                        <i class="fas fa-user-plus me-1"></i>Sign Up
                    </button>
                </div>
                
                <div class="navbar-nav d-none" id="user-menu">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <img src="" alt="Profile" class="rounded-circle me-2" width="36" height="36" id="navbar-profile-photo">
                            <span id="navbar-user-name">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="showProfileSection()"><i class="fas fa-user me-2"></i>Profile</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="showLogoutModal()"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Home Section -->
    <section id="home-section" class="section-content active">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <div class="hero-content">
                            <h1 class="display-4 fw-bold mb-4">Launch Your Dream Career Today</h1>
                            <p class="lead mb-4">Join thousands of professionals who found their perfect career match through our innovative platform.</p>
                            
                            <div class="search-box">
                                <div class="input-group">
                                    <input type="text" class="form-control border-0 bg-transparent text-white" placeholder="Job title, company, or keyword" id="search-input">
                                    <button class="btn btn-light rounded-pill px-4" onclick="searchJobs()">
                                        <i class="fas fa-search me-2"></i> Search
                                    </button>
                                </div>
                            </div>
                            <small class="text-white-50 mt-2 d-block"><i class="fas fa-lightbulb me-1"></i>Try: "Software Engineer", "Marketing", "Remote"</small>
                        </div>
                    </div>
                    <div class="col-lg-6 text-center">
                        <img src="https://cdn.pixabay.com/photo/2018/03/10/12/00/teamwork-3213924_1280.jpg" alt="Career" class="img-fluid rounded-3 shadow-lg">
                    </div>
                </div>
            </div>
        </div>

        <!-- How to Apply -->
        <div class="container my-5 py-5">
            <div class="row text-center mb-5">
                <div class="col-12">
                    <h2 class="fw-bold display-5 mb-3">How It Works</h2>
                    <p class="text-muted fs-5">Get your dream job in 3 simple steps</p>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="step-card fade-in">
                        <div class="step-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h4 class="fw-bold mb-3">Create Account</h4>
                        <p class="text-muted">Sign up and complete your profile to get started with your career journey</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="step-card fade-in">
                        <div class="step-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h4 class="fw-bold mb-3">Search Jobs</h4>
                        <p class="text-muted">Browse through thousands of curated job opportunities from top companies</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="step-card fade-in">
                        <div class="step-icon">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <h4 class="fw-bold mb-3">Apply Now</h4>
                        <p class="text-muted">Submit your application with just one click and track your progress</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Featured Companies -->
        <div class="bg-light py-5">
            <div class="container">
                <div class="row mb-5">
                    <div class="col-12 text-center">
                        <h3 class="fw-bold display-6 mb-3">Trusted by Top Companies</h3>
                        <p class="text-muted fs-5">Join leading organizations worldwide</p>
                    </div>
                </div>
                <div class="row g-4" id="companies-slider">
                    <!-- Companies will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Jobs Section -->
    <section id="jobs-section" class="section-content">
        <div class="container my-5 py-4">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="jobs-search-container">
                        <h3 class="fw-bold mb-4">Find Your Perfect Job</h3>
                        <div class="row g-3">
                            <div class="col-md-8">
                                <input type="text" class="form-control form-control-lg" placeholder="Search by job title, company, or location..." id="jobs-search-input" onkeyup="handleJobSearch()">
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary btn-lg w-100" onclick="performJobSearch()">
                                    <i class="fas fa-search me-2"></i>Search Jobs
                                </button>
                            </div>
                        </div>
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Search for job titles like "Software Engineer", companies like "Google", or locations like "Remote"
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" id="jobs-list">
                <!-- Jobs will be loaded here -->
                <div class="col-12 text-center">
                    <div class="spinner" id="jobs-spinner"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Section -->
    <section id="profile-section" class="section-content">
        <div class="container my-5 py-4">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="profile-section text-center">
                        <img src="" alt="Profile" class="profile-photo mb-4" id="profile-photo">
                        <h3 class="fw-bold mb-2" id="profile-full-name">John Doe</h3>
                        <p class="text-muted mb-4" id="profile-email">john@example.com</p>
                        
                        <div class="mb-4">
                            <button class="btn btn-outline-primary btn-sm me-2" onclick="document.getElementById('photo-upload').click()">
                                <i class="fas fa-camera me-2"></i>Upload Photo
                            </button>
                            <input type="file" id="photo-upload" accept="image/*" class="d-none" onchange="uploadPhoto(this.files[0])">
                        </div>
                        
                        <div class="text-start bg-light rounded-3 p-4">
                            <p class="mb-3">
                                <i class="fas fa-map-marker-alt text-primary me-2"></i> 
                                <span id="profile-address">Not set</span>
                            </p>
                            <p class="mb-0">
                                <i class="fas fa-phone text-primary me-2"></i> 
                                <span id="profile-phone">Not set</span>
                            </p>
                        </div>
                        
                        <button class="btn btn-primary w-100 mt-4" onclick="showEditProfileModal()">
                            <i class="fas fa-edit me-2"></i>Edit Profile
                        </button>

                        <button class="btn build-resume-btn w-100 mt-3" onclick="showBuildResumeModal()">
                            <i class="fas fa-file-alt me-2"></i>Build Resume
                        </button>
                    </div>
                </div>
                
                <div class="col-lg-8">
                    <!-- User Details -->
                    <div class="profile-section mb-4">
                        <h4 class="fw-bold mb-4">
                            <i class="fas fa-user-circle me-2"></i>Personal Information
                        </h4>
                        <div class="table-responsive">
                            <table class="table table-bordered table-custom">
                                <tr>
                                    <th width="30%">Full Name</th>
                                    <td id="info-full-name">-</td>
                                </tr>
                                <tr>
                                    <th>Email</th>
                                    <td id="info-email">-</td>
                                </tr>
                                <tr>
                                    <th>Address</th>
                                    <td id="info-address">-</td>
                                </tr>
                                <tr>
                                    <th>Phone</th>
                                    <td id="info-phone">-</td>
                                </tr>
                                <tr>
                                    <th>Member Since</th>
                                    <td id="info-joined">-</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Job Applications -->
                    <div class="profile-section">
                        <h4 class="fw-bold mb-4">
                            <i class="fas fa-file-alt me-2"></i>My Job Applications
                        </h4>
                        <div class="table-responsive">
                            <table class="table table-bordered table-custom" id="applications-table">
                                <thead>
                                    <tr>
                                        <th>Job Title</th>
                                        <th>Company</th>
                                        <th>Applied Date</th>
                                        <th>Status</th>
                                        <th>CV</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Applications will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Panel Section -->
    <section id="admin-section" class="section-content">
        <div class="container my-5 py-4">
            <!-- Admin Header with Logout -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold">
                    <i class="fas fa-cog me-2"></i>Admin Dashboard
                </h2>
                <button class="btn btn-outline-light" onclick="adminLogout()">
                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                </button>
            </div>

            <div class="admin-panel mb-5">
                <div class="row g-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="total-users">0</div>
                            <div class="text-white">Total Users</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="total-jobs">0</div>
                            <div class="text-white">Total Jobs</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="total-applications">0</div>
                            <div class="text-white">Applications</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number" id="pending-applications">0</div>
                            <div class="text-white">Pending</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <div class="col-md-6">
                    <div class="profile-section">
                        <h5 class="fw-bold mb-4">
                            <i class="fas fa-users me-2"></i>Manage Users
                        </h5>
                        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-bordered table-custom">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="profile-section">
                        <h5 class="fw-bold mb-4">
                            <i class="fas fa-plus-circle me-2"></i>Add New Job
                        </h5>
                        <form id="add-job-form">
                            <div class="mb-3">
                                <input type="text" class="form-control" placeholder="Job Title" id="job-title" required>
                            </div>
                            <div class="mb-3">
                                <textarea class="form-control" placeholder="Job Description" id="job-description" rows="3" required></textarea>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="Company" id="job-company" required>
                                </div>
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="Location" id="job-location" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <input type="text" class="form-control" placeholder="Salary" id="job-salary" required>
                                </div>
                                <div class="col-md-6">
                                    <select class="form-control" id="job-type" required>
                                        <option value="">Job Type</option>
                                        <option value="Full-time">Full-time</option>
                                        <option value="Part-time">Part-time</option>
                                        <option value="Contract">Contract</option>
                                        <option value="Remote">Remote</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Company Logo</label>
                                <input type="file" class="form-control" accept="image/*" id="company-logo">
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-plus me-2"></i>Add Job
                            </button>
                        </form>
                    </div>
                    <!-- Video Profiles Management -->
<!-- Admin Videos Section -->
     </div>
            </div>

            <div class="profile-section mt-4">
                <h5 class="fw-bold mb-4">
                    <i class="fas fa-tasks me-2"></i>All Job Applications
                </h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-custom">
                        <thead>
                            <tr>
                                <th>User Name</th>
                                <th>Job Title</th>
                                <th>Company</th>
                                <th>Applied Date</th>
                                <th>Status</th>
                                <th>CV</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admin-applications-table">
                            <!-- Applications will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- Modals -->
    <div class="modal fade" id="loginModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-sign-in-alt me-2"></i>Login to Your Account
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" placeholder="Enter your email" id="login-email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" placeholder="Enter your password" id="login-password" required>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">Remember me</label>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-sign-in-alt me-2"></i>Login
                        </button>
                        <div class="text-center">
                            <a href="#" class="text-decoration-none" onclick="showForgotPasswordModal()">
                                Forgot Password?
                            </a>
                        </div>
                    </form>
                    <div class="text-center mt-3">
                        <span class="text-muted">Don't have an account? </span>
                        <a href="#" class="text-decoration-none fw-bold" onclick="showSignupModal()">Sign Up Now</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="signupModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-user-plus me-2"></i>Create New Account
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="signup-form">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" placeholder="Enter your full name" id="signup-fullname" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <input type="email" class="form-control" placeholder="Enter your email" id="signup-email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Enter your address" id="signup-address" required>
                                <button class="btn btn-outline-primary" type="button" onclick="getLocation()">
                                    <i class="fas fa-location-arrow"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" placeholder="Enter your phone number" id="signup-phone" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" placeholder="Create a strong password" id="signup-password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus me-2"></i>Create Account
                        </button>
                    </form>
                    <div class="text-center mt-3">
                        <span class="text-muted">Already have an account? </span>
                        <a href="#" class="text-decoration-none fw-bold" onclick="showLoginModal()">Login Here</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="forgotPasswordModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-key me-2"></i>Forgot Password
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="forgot-password-form">
                        <div class="mb-3">
                            <label class="form-label">Enter your email address</label>
                            <input type="email" class="form-control" placeholder="Your registered email" id="forgot-email" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-paper-plane me-2"></i>Retrieve Password
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="applyJobModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-paper-plane me-2"></i>Apply for Job
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="apply-job-form">
                        <input type="hidden" id="apply-job-id">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control auto-fill-field" id="apply-fullname" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control auto-fill-field" id="apply-email" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control auto-fill-field" id="apply-phone" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control auto-fill-field" id="apply-address" readonly>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Upload Your CV (PDF/Image) *</label>
                            <input type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png" id="apply-cv" required>
                            <div class="form-text">Supported formats: PDF, JPG, PNG (Max: 10MB)</div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-paper-plane me-2"></i>Submit Application
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
<!-- Video Upload Modal -->
<div class="modal fade" id="videoUploadModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content modal-custom">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-video me-2"></i>Record 10-Second Video Profile
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="video-recorder">
                    <div class="mb-4">
                        <h6>Record a 10-second introduction video</h6>
                        <p class="text-muted">Show your personality to employers!</p>
                    </div>
                    
                    <div class="camera-preview mb-3">
                        <video id="camera-preview" autoplay muted class="video-preview"></video>
                    </div>
                    
                    <div class="timer" id="record-timer">00:10</div>
                    
                    <button class="record-btn" id="record-btn" onclick="startRecording()">
                        <i class="fas fa-video"></i>
                    </button>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Video will auto-delete after 5 days
                        </small>
                    </div>
                </div>
                
                <div id="video-preview-container" class="text-center">
                    <!-- Video preview will appear here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Video Profile Button in Profile Section -->
<!-- Add this in your profile section HTML -->
<div id="user-video-container" class="mt-4">
    <!-- Video profile will be loaded here -->
</div>

<!-- Add Admin Videos Section -->
<!-- Add this in your admin section HTML -->
<div id="admin-videos-container" class="mt-4">
    <!-- Admin videos will be loaded here -->
</div>
    <div class="modal fade" id="editProfileModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>Edit Profile
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-profile-form">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="edit-full-name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-control" id="edit-address" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="edit-phone" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-save me-2"></i>Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="buildResumeModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-alt me-2"></i>Build Your Resume
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="build-resume-form">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="resume-fullname" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="resume-email" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="resume-phone" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control" id="resume-address" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Professional Summary</label>
                            <textarea class="form-control" id="resume-summary" rows="3" placeholder="Briefly describe your professional background and skills"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Skills (comma separated)</label>
                            <input type="text" class="form-control" id="resume-skills" placeholder="e.g., JavaScript, React, Node.js, MongoDB">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Experience (Years)</label>
                            <input type="number" class="form-control" id="resume-experience" min="0" max="50">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Education</label>
                            <textarea class="form-control" id="resume-education" rows="2" placeholder="Your educational background"></textarea>
                        </div>
                        <button type="submit" class="btn build-resume-btn w-100">
                            <i class="fas fa-download me-2"></i>Generate & Download Resume
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="viewCVModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-pdf me-2"></i>CV Preview
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="cv-preview-container">
                        <img src="" alt="CV Preview" class="cv-preview" id="cv-preview-image" style="display: none;">
                        <iframe src="" id="cv-preview-pdf" style="display: none; width: 100%; height: 600px; border: none;"></iframe>
                        <div id="cv-preview-placeholder" class="text-muted">
                            <i class="fas fa-file-alt fa-5x mb-3"></i>
                            <h5>CV Preview</h5>
                            <p>Select a CV file to preview</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="downloadCV()">
                        <i class="fas fa-download me-2"></i>Download CV
                    </button>
                </div>
            </div>
        </div>
    </div>
<!-- Feedback Modal -->
<div class="modal fade" id="feedbackModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content feedback-modal-content">
            <div class="modal-header feedback-modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-comment-medical me-2"></i>Share Your Feedback
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body feedback-modal-body">
                <form id="feedback-form">
                    <div class="mb-4">
                        <label class="form-label fw-bold">How would you rate your experience?</label>
                        <div class="rating-stars">
                            <input type="radio" id="star5" name="feedback-rating" value="5">
                            <label for="star5"><i class="fas fa-star"></i></label>
                            
                            <input type="radio" id="star4" name="feedback-rating" value="4">
                            <label for="star4"><i class="fas fa-star"></i></label>
                            
                            <input type="radio" id="star3" name="feedback-rating" value="3">
                            <label for="star3"><i class="fas fa-star"></i></label>
                            
                            <input type="radio" id="star2" name="feedback-rating" value="2">
                            <label for="star2"><i class="fas fa-star"></i></label>
                            
                            <input type="radio" id="star1" name="feedback-rating" value="1">
                            <label for="star1"><i class="fas fa-star"></i></label>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Your Feedback Message</label>
                        <textarea class="form-control feedback-textarea" 
                                  placeholder="Tell us about your experience, suggestions, or any issues you faced..."
                                  id="feedback-message" required></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">Attach Photo (Optional)</label>
                        <input type="file" class="form-control" accept="image/*" 
                               id="feedback-photo" onchange="previewFeedbackPhoto(this)">
                        <div class="form-text">Share a screenshot or photo related to your feedback</div>
                    </div>
                    
                    <div class="photo-preview" id="feedback-photo-preview">
                        <!-- Photo preview will appear here -->
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary btn-lg" onclick="submitFeedback()">
                            <i class="fas fa-paper-plane me-2"></i>Submit Feedback
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- My Feedback Modal -->
<div class="modal fade" id="myFeedbackModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content feedback-modal-content">
            <div class="modal-header feedback-modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-comments me-2"></i>My Feedback
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body feedback-modal-body">
                <div id="user-feedback-list">
                    <!-- User's feedback will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Admin Feedback Modal -->
<div class="modal fade" id="adminFeedbackModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content feedback-modal-content">
            <div class="modal-header feedback-modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-comments me-2"></i>All User Feedback
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body feedback-modal-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-custom">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Rating</th>
                                <th>Message</th>
                                <th>Date</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="admin-feedback-list">
                            <!-- All feedback will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- View Photo Modal -->
<div class="modal fade" id="viewPhotoModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-image me-2"></i>Feedback Photo
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img src="" alt="Feedback Photo" class="img-fluid rounded" id="feedback-photo-full">
            </div>
        </div>
    </div>
</div>
    <div class="modal fade" id="editEmailModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-envelope me-2"></i>Edit User Email
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-email-form">
                        <input type="hidden" id="edit-user-id">
                        <div class="mb-3">
                            <label class="form-label">New Email Address</label>
                            <input type="email" class="form-control" id="edit-user-email" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-save me-2"></i>Update Email
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="logoutModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-custom">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-sign-out-alt me-2"></i>Confirm Logout
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-sign-out-alt fa-4x text-warning mb-4"></i>
                    <h4 class="fw-bold mb-3">Are you sure you want to logout?</h4>
                    <p class="text-muted">You'll need to login again to access your account</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-primary" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i>Yes, Logout
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script>
        // Demo Data Storage using localStorage
       // API Service - Real Backend Integration
const ApiService = {
    // Base URL for backend
    BASE_URL: 'http://localhost:8080',
    
    // Auth endpoints
    async login(email, password) {
        try {
            const formData = new URLSearchParams();
            formData.append('email', email);
            formData.append('password', password);
            
            const response = await fetch(`${this.BASE_URL}/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Connection failed. Please try again." };
        }
    },

    async signup(userData) {
        try {
            const formData = new URLSearchParams();
            formData.append('fullName', userData.fullName);
            formData.append('email', userData.email);
            formData.append('password', userData.password);
            formData.append('address', userData.address);
            formData.append('phone', userData.phone);
            
            const response = await fetch(`${this.BASE_URL}/signup`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Connection failed. Please try again." };
        }
    },

    async checkAuth() {
        try {
            const response = await fetch(`${this.BASE_URL}/check-auth`, {
                method: 'GET',
                credentials: 'include'
            });
            const data = await response.json();
            
            if (data.loggedIn) {
                return {
                    loggedIn: true,
                    isAdmin: data.isAdmin,
                    user: data.user,
                    fullName: data.user?.fullName,
                    profilePhoto: data.user?.profilePhotoPath
                };
            }
            
            return { loggedIn: false, isAdmin: false };
        } catch (error) {
            return { loggedIn: false, isAdmin: false };
        }
    },

    async logout() {
        try {
            const response = await fetch(`${this.BASE_URL}/logout`, {
                method: 'POST',
                credentials: 'include'
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Logout failed" };
        }
    },

    // Jobs endpoints
    async getJobs() {
        try {
            const response = await fetch(`${this.BASE_URL}/jobs`, {
                method: 'GET',
                credentials: 'include'
            });
            const data = await response.json();
            return Array.isArray(data) ? data : [];
        } catch (error) {
            return [];
        }
    },

    async applyJob(applicationData) {
        try {
            const formData = new FormData();
            formData.append('jobId', applicationData.jobId);
            formData.append('cv', applicationData.cvFile);
            
            const response = await fetch(`${this.BASE_URL}/apply-job`, {
                method: 'POST',
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Application failed. Please try again." };
        }
    },

    async searchJobs(query) {
        try {
            const response = await fetch(`${this.BASE_URL}/jobs/search?query=${encodeURIComponent(query)}`, {
                method: 'GET',
                credentials: 'include'
            });
            const data = await response.json();
            return Array.isArray(data) ? data : [];
        } catch (error) {
            return [];
        }
    },

    // User endpoints
    async updateProfile(profileData) {
        try {
            const formData = new URLSearchParams();
            formData.append('fullName', profileData.fullName);
            formData.append('address', profileData.address);
            formData.append('phone', profileData.phone);
            
            const response = await fetch(`${this.BASE_URL}/update-profile`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Profile update failed" };
        }
    },

    async uploadPhoto(photoFile) {
        try {
            const formData = new FormData();
            formData.append('photo', photoFile);
            formData.append('type', 'profile_photo');
            
            const response = await fetch(`${this.BASE_URL}/upload-photo`, {
                method: 'POST',
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Photo upload failed" };
        }
    },

    async getUserApplications() {
        try {
            const response = await fetch(`${this.BASE_URL}/user-applications`, {
                method: 'GET',
                credentials: 'include'
            });
            const data = await response.json();
            return Array.isArray(data) ? data : [];
        } catch (error) {
            return [];
        }
    },

    // Admin endpoints
    async getAdminDashboard() {
        try {
            const response = await fetch(`${this.BASE_URL}/admin/dashboard`, {
                method: 'GET',
                credentials: 'include'
            });
            const data = await response.json();
            return data || {
                totalUsers: 0,
                totalJobs: 0,
                totalApplications: 0,
                pendingApplications: 0,
                successApplications: 0,
                rejectedApplications: 0
            };
        } catch (error) {
            return {
                totalUsers: 0,
                totalJobs: 0,
                totalApplications: 0,
                pendingApplications: 0,
                successApplications: 0,
                rejectedApplications: 0
            };
        }
    },

    async getAllUsers() {
        try {
            const response = await fetch(`${this.BASE_URL}/admin/users`, {
                method: 'GET',
                credentials: 'include'
            });
            const data = await response.json();
            return Array.isArray(data) ? data : [];
        } catch (error) {
            return [];
        }
    },

    async getAllApplications() {
        try {
            const response = await fetch(`${this.BASE_URL}/admin/applications`, {
                method: 'GET',
                credentials: 'include'
            });
            const data = await response.json();
            
            if (Array.isArray(data)) {
                return data.map(app => ({
                    id: app.id,
                    userId: app.userId,
                    jobId: app.jobId,
                    cvFileId: app.cvFileId,
                    status: app.status,
                    appliedAt: app.appliedAt,
                    statusUpdatedAt: app.statusUpdatedAt,
                    jobTitle: app.job?.title || 'Job Not Found',
                    company: app.job?.company || 'N/A',
                    userName: app.user?.fullName || 'Unknown User',
                    userEmail: app.user?.email || 'No Email'
                }));
            }
            return [];
        } catch (error) {
            return [];
        }
    },

    async updateUserEmail(userId, newEmail) {
        try {
            const formData = new URLSearchParams();
            formData.append('userId', userId);
            formData.append('newEmail', newEmail);
            
            const response = await fetch(`${this.BASE_URL}/admin/update-email`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Email update failed" };
        }
    },

    async updateApplicationStatus(applicationId, status) {
        try {
            const formData = new URLSearchParams();
            formData.append('applicationId', applicationId);
            formData.append('status', status);
            
            const response = await fetch(`${this.BASE_URL}/admin/update-application-status`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Status update failed" };
        }
    },

    async addJob(jobData) {
        try {
            const formData = new URLSearchParams();
            formData.append('title', jobData.title);
            formData.append('description', jobData.description);
            formData.append('company', jobData.company);
            formData.append('location', jobData.location);
            formData.append('salary', jobData.salary);
            formData.append('jobType', jobData.jobType);
            
            const response = await fetch(`${this.BASE_URL}/admin/add-job`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Failed to add job" };
        }
    },

    async forgotPassword(email) {
        try {
            const formData = new URLSearchParams();
            formData.append('email', email);
            
            const response = await fetch(`${this.BASE_URL}/forgot-password`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                credentials: 'include',
                body: formData
            });
            return await response.json();
        } catch (error) {
            return { success: false, message: "Password retrieval failed" };
        }
    },

    // File endpoints
    async getCVFile(cvFileId) {
        try {
            if (!cvFileId) {
                return { success: false, message: "CV file not found" };
            }
            
            // If it's a file path (starts with /uploads/)
            if (cvFileId.startsWith('/uploads/')) {
                return {
                    success: true,
                    url: `${this.BASE_URL}${cvFileId}`,
                    type: 'application/pdf'
                };
            }
            
            // If it's a file ID from MongoDB
            const response = await fetch(`${this.BASE_URL}/files/${cvFileId}`, {
                method: 'GET',
                credentials: 'include'
            });
            
            if (response.ok) {
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                return {
                    success: true,
                    url: url,
                    type: response.headers.get('content-type') || 'application/pdf'
                };
            }
            
            return { success: false, message: "CV file not found" };
        } catch (error) {
            return { success: false, message: "Failed to load CV" };
        }
    }
};

// File Storage Service for localStorage simulation
const FileStorageService = {
    STORAGE_KEYS: {
        FILES: 'jobportal_files'
    },

    // Store file in localStorage (simulating MongoDB)
    async storeFile(file, type, userId) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const fileData = {
                    id: `file_${Date.now()}`,
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    data: e.target.result,
                    userId: userId,
                    uploadedAt: new Date().toISOString()
                };
                
                const files = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.FILES) || '{}');
                files[fileData.id] = fileData;
                localStorage.setItem(this.STORAGE_KEYS.FILES, JSON.stringify(files));
                
                resolve({
                    success: true,
                    fileId: fileData.id,
                    filePath: `/files/${fileData.id}`,
                    message: "File uploaded successfully"
                });
            }.bind(this);
            reader.readAsDataURL(file);
        });
    },

    // Get file from storage
    async getFile(fileId) {
        const files = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.FILES) || '{}');
        return files[fileId] || null;
    },

    // Preview file
    async previewFile(fileId) {
        const file = await this.getFile(fileId);
        if (!file) {
            return { success: false, message: "File not found" };
        }

        return {
            success: true,
            file: file,
            url: file.data,
            type: file.type
        };
    }
};

// Global variables
let currentUser = null;
let isAdmin = false;
let allJobs = [];
let currentModal = null;
let currentCVFile = null;

// Initialize application
document.addEventListener('DOMContentLoaded', function() {
    initializeDemoData();
    checkAuth();
    loadJobs();
    loadCompanies();
    setupEventListeners();
});

// Initialize demo data in localStorage
function initializeDemoData() {
    // Initialize files storage if not exists
    if (!localStorage.getItem('jobportal_files')) {
        localStorage.setItem('jobportal_files', JSON.stringify({}));
    }
}

// Setup all event listeners
function setupEventListeners() {
    // Form submissions
    document.getElementById('login-form').addEventListener('submit', handleLogin);
    document.getElementById('signup-form').addEventListener('submit', handleSignup);
    document.getElementById('forgot-password-form').addEventListener('submit', handleForgotPassword);
    document.getElementById('edit-profile-form').addEventListener('submit', handleEditProfile);
    document.getElementById('build-resume-form').addEventListener('submit', handleBuildResume);
    document.getElementById('apply-job-form').addEventListener('submit', handleApplyJob);
    document.getElementById('edit-email-form').addEventListener('submit', handleEditEmail);
    document.getElementById('add-job-form').addEventListener('submit', handleAddJob);

    // Search functionality
    document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchJobs();
        }
    });

    document.getElementById('jobs-search-input').addEventListener('input', handleJobSearch);

    // Photo upload
    document.getElementById('profile-photo-upload').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            uploadPhoto(e.target.files[0]);
        }
    });

    // Location detection
    document.getElementById('detect-location').addEventListener('click', getLocation);
}

// Close any open modal before opening new one
function closeCurrentModal() {
    if (currentModal) {
        const modal = bootstrap.Modal.getInstance(currentModal);
        if (modal) modal.hide();
    }
}

// Authentication functions
async function checkAuth() {
    try {
        const response = await fetch('/check-auth');
        const data = await response.json();
        
        if (data.loggedIn) {
            currentUser = data.user;
            isAdmin = data.isAdmin;
            
            if (isAdmin) {
                // Hide main navbar for admin
                document.getElementById('main-navbar').classList.add('d-none');
                
                // Initialize admin features
                setTimeout(() => {
                    initializeAdminFeedbackPanel();
                }, 1000);
                
                // Show admin panel
                showAdminPanel();
            } else {
                // Show main navbar for regular users
                document.getElementById('main-navbar').classList.remove('d-none');
                
                // Show user menu with user data
                showUserMenu(data.user.fullName, data.user.profilePhotoPath);
                
                // Load fresh profile data and applications
                loadUserProfile();
                loadUserApplications();
            }
        } else {
            // User is not logged in
            showAuthButtons();
            document.getElementById('main-navbar').classList.remove('d-none');
        }
    } catch (error) {
        console.error('Auth check failed:', error);
        showToast('Connection error. Please try again.', 'error');
    }
}

function showUserMenu(fullName, profilePhoto) {
    document.getElementById('auth-buttons').classList.add('d-none');
    document.getElementById('user-menu').classList.remove('d-none');
    
    document.getElementById('navbar-user-name').textContent = fullName || 'User';
    const profilePhotoEl = document.getElementById('navbar-profile-photo');
    if (profilePhoto) {
        profilePhotoEl.src = profilePhoto;
    } else {
        profilePhotoEl.src = 'https://via.placeholder.com/36x36/4361ee/ffffff?text=U';
    }
}

function showAuthButtons() {
    document.getElementById('auth-buttons').classList.remove('d-none');
    document.getElementById('user-menu').classList.add('d-none');
}

// Profile section with login check
function showProfileSection() {
    if (!currentUser) {
        showToast('Please login to view your profile', 'warning');
        showLoginModal();
        return;
    }
    showSection('profile');
}

// Modal functions
function showLoginModal() {
    closeCurrentModal();
    const modalElement = document.getElementById('loginModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

function showSignupModal() {
    closeCurrentModal();
    const modalElement = document.getElementById('signupModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

function showForgotPasswordModal() {
    closeCurrentModal();
    const modalElement = document.getElementById('forgotPasswordModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

function showLogoutModal() {
    closeCurrentModal();
    const modalElement = document.getElementById('logoutModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

function showEditProfileModal() {
    if (currentUser) {
        closeCurrentModal();
        document.getElementById('edit-full-name').value = currentUser.fullName || '';
        document.getElementById('edit-address').value = currentUser.address || '';
        document.getElementById('edit-phone').value = currentUser.phone || '';
        
        const modalElement = document.getElementById('editProfileModal');
        currentModal = modalElement;
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
    }
}

function showBuildResumeModal() {
    closeCurrentModal();
    if (currentUser) {
        document.getElementById('resume-fullname').value = currentUser.fullName || '';
        document.getElementById('resume-email').value = currentUser.email || '';
        document.getElementById('resume-phone').value = currentUser.phone || '';
        document.getElementById('resume-address').value = currentUser.address || '';
    }
    
    const modalElement = document.getElementById('buildResumeModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

// Form handlers
async function handleLogin(e) {
    e.preventDefault();
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    try {
        const data = await ApiService.login(email, password);
        
        if (data.success) {
            showToast(data.message, 'success');
            closeCurrentModal();
            
            // Wait a bit for session to be set
            setTimeout(() => {
                checkAuth();
                if (data.isAdmin) {
                    showAdminPanel();
                } else {
                    showSection('home');
                }
            }, 500);
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Login failed. Please try again.', 'error');
    }
}

async function handleSignup(e) {
    e.preventDefault();
    const userData = {
        fullName: document.getElementById('signup-fullname').value,
        email: document.getElementById('signup-email').value,
        address: document.getElementById('signup-address').value,
        phone: document.getElementById('signup-phone').value,
        password: document.getElementById('signup-password').value
    };
    
    try {
        const data = await ApiService.signup(userData);
        
        if (data.success) {
            showToast(data.message, 'success');
            closeCurrentModal();
            setTimeout(() => {
                checkAuth();
                showSection('home');
            }, 500);
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Signup failed. Please try again.', 'error');
    }
}

async function handleForgotPassword(e) {
    e.preventDefault();
    const email = document.getElementById('forgot-email').value;
    
    try {
        const data = await ApiService.forgotPassword(email);
        
        if (data.success) {
            showToast(`Your password is: ${data.password}`, 'success');
            closeCurrentModal();
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Failed to retrieve password.', 'error');
    }
}

async function handleEditProfile(e) {
    e.preventDefault();
    const profileData = {
        fullName: document.getElementById('edit-full-name').value,
        address: document.getElementById('edit-address').value,
        phone: document.getElementById('edit-phone').value
    };
    
    try {
        const data = await ApiService.updateProfile(profileData);
        
        if (data.success) {
            showToast(data.message, 'success');
            closeCurrentModal();
            checkAuth();
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Profile update failed.', 'error');
    }
}

function handleBuildResume(e) {
    e.preventDefault();
    generateResume();
}

async function handleApplyJob(e) {
    e.preventDefault();
    const jobId = document.getElementById('apply-job-id').value;
    const cvFile = document.getElementById('apply-cv').files[0];
    
    if (!cvFile) {
        showToast('Please select a CV file', 'warning');
        return;
    }
    
    // Validate file type
    const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
    if (!allowedTypes.includes(cvFile.type)) {
        showToast('Please select a PDF or image file (JPEG, JPG, PNG)', 'error');
        return;
    }
    
    try {
        // Store CV file in localStorage simulation
        const fileResult = await FileStorageService.storeFile(cvFile, 'cv', currentUser.id);
        if (!fileResult.success) {
            showToast('Failed to upload CV file', 'error');
            return;
        }
        
        const applicationData = {
            jobId: parseInt(jobId),
            cvFileId: fileResult.fileId
        };
        
        const data = await ApiService.applyJob(applicationData);
        
        if (data.success) {
            showToast(data.message, 'success');
            closeCurrentModal();
            document.getElementById('apply-job-form').reset();
            loadUserApplications();
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Application failed. Please try again.', 'error');
    }
}

async function handleEditEmail(e) {
    e.preventDefault();
    const userId = parseInt(document.getElementById('edit-user-id').value);
    const newEmail = document.getElementById('edit-user-email').value;
    
    try {
        const data = await ApiService.updateUserEmail(userId, newEmail);
        
        if (data.success) {
            showToast(data.message, 'success');
            closeCurrentModal();
            loadAdminData();
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Email update failed.', 'error');
    }
}

async function handleAddJob(e) {
    e.preventDefault();
    const jobData = {
        title: document.getElementById('job-title').value,
        description: document.getElementById('job-description').value,
        company: document.getElementById('job-company').value,
        location: document.getElementById('job-location').value,
        salary: document.getElementById('job-salary').value,
        jobType: document.getElementById('job-type').value
    };
    
    try {
        const data = await ApiService.addJob(jobData);
        
        if (data.success) {
            showToast(data.message, 'success');
            e.target.reset();
            loadJobs();
            loadAdminData();
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Failed to add job.', 'error');
    }
}

// Resume generation
function generateResume() {
    const fullName = document.getElementById('resume-fullname').value;
    const email = document.getElementById('resume-email').value;
    const phone = document.getElementById('resume-phone').value;
    const address = document.getElementById('resume-address').value;
    const summary = document.getElementById('resume-summary').value;
    const skills = document.getElementById('resume-skills').value;
    const experience = document.getElementById('resume-experience').value;
    const education = document.getElementById('resume-education').value;

    // Create resume content
    const resumeContent = `
        <!DOCTYPE html>
        <html>
        <head>
            <title>Resume - ${fullName}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 40px; }
                .header { text-align: center; margin-bottom: 30px; }
                .section { margin-bottom: 20px; }
                .section-title { border-bottom: 2px solid #333; padding-bottom: 5px; margin-bottom: 10px; }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>${fullName}</h1>
                <p>${email} | ${phone} | ${address}</p>
            </div>
            
            <div class="section">
                <h2 class="section-title">Professional Summary</h2>
                <p>${summary}</p>
            </div>
            
            ${skills ? `
            <div class="section">
                <h2 class="section-title">Skills</h2>
                <p>${skills}</p>
            </div>
            ` : ''}
            
            ${experience ? `
            <div class="section">
                <h2 class="section-title">Experience</h2>
                <p>${experience} years of professional experience</p>
            </div>
            ` : ''}
            
            ${education ? `
            <div class="section">
                <h2 class="section-title">Education</h2>
                <p>${education}</p>
            </div>
            ` : ''}
        </body>
        </html>
    `;

    // Create and download HTML file
    const blob = new Blob([resumeContent], { type: 'text/html' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${fullName.replace(/\s+/g, '_')}_Resume.html`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    showToast('Resume generated and downloaded successfully!', 'success');
    closeCurrentModal();
}

// Section navigation
function showSection(sectionName) {
    document.querySelectorAll('.section-content').forEach(section => {
        section.classList.remove('active');
    });
    
    document.getElementById(sectionName + '-section').classList.add('active');
    
    if (!isAdmin) {
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // Add active class to current nav link
        const activeLink = document.querySelector(`[onclick="showSection('${sectionName}')"]`);
        if (activeLink) {
            activeLink.classList.add('active');
        }
    }
    
    if (sectionName === 'jobs') {
        loadJobs();
    } else if (sectionName === 'profile' && currentUser) {
        loadUserProfile();
        loadUserApplications();
    }
}

// Data loading functions
async function loadJobs() {
    try {
        // Show loading spinner
        const jobsSpinner = document.getElementById('jobs-spinner');
        if (jobsSpinner) {
            jobsSpinner.classList.remove('d-none');
        }
        
        const response = await fetch('/jobs');
        const data = await response.json();
        
        if (data.success) {
            allJobs = data.data || [];
            displayJobs(allJobs);
        } else {
            console.error('Failed to load jobs:', data.message);
            displayJobs([]);
        }
        
        // Hide loading spinner
        if (jobsSpinner) {
            jobsSpinner.classList.add('d-none');
        }
    } catch (error) {
        console.error('Failed to load jobs:', error);
        displayJobs([]);
        
        // Hide loading spinner even on error
        const jobsSpinner = document.getElementById('jobs-spinner');
        if (jobsSpinner) {
            jobsSpinner.classList.add('d-none');
        }
    }
}

function displayJobs(jobs) {
    const container = document.getElementById('jobs-list');
    container.innerHTML = '';
    
    if (!jobs || jobs.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center">
                <div class="profile-section">
                    <i class="fas fa-briefcase fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">No jobs available</h4>
                    <p class="text-muted">Check back later for new opportunities</p>
                </div>
            </div>
        `;
        return;
    }
    
    jobs.forEach(job => {
        // Ensure company name is never null or empty
        const companyName = job.company && job.company.trim() !== '' ? job.company : 'Leading Tech Company';
        const jobTitle = job.title && job.title.trim() !== '' ? job.title : 'Software Position';
        const location = job.location && job.location.trim() !== '' ? job.location : 'Multiple Locations';
        const salary = job.salary && job.salary.trim() !== '' ? job.salary : 'Competitive Salary';
        const jobType = job.jobType && job.jobType.trim() !== '' ? job.jobType : 'Full-time';
        
        const jobCard = `
            <div class="col-md-6 col-lg-4 fade-in">
                <div class="job-card card h-100">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex align-items-center mb-3">
                            ${job.companyLogoPath ? 
                                `<img src="${job.companyLogoPath}" alt="${companyName}" class="company-logo me-3" onerror="this.src='https://via.placeholder.com/70x70/4361ee/ffffff?text=${companyName.charAt(0)}'">` : 
                                `<div class="company-logo bg-light rounded d-flex align-items-center justify-content-center me-3">
                                    <i class="fas fa-building text-primary"></i>
                                </div>`
                            }
                            <div>
                                <h6 class="mb-0 fw-bold">${companyName}</h6>
                                <small class="text-muted">
                                    <i class="fas fa-map-marker-alt me-1"></i>${location}
                                </small>
                            </div>
                        </div>
                        <h5 class="card-title fw-bold">${jobTitle}</h5>
                        <p class="card-text text-muted flex-grow-1">${job.description ? job.description.substring(0, 120) + '...' : 'Join our dynamic team and work on exciting projects with cutting-edge technologies.'}</p>
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-primary">${jobType}</span>
                            <strong class="text-success">${salary}</strong>
                        </div>
                        <button class="btn btn-primary w-100 mt-auto" onclick="showApplyModal(${job.id})">
                            <i class="fas fa-paper-plane me-2"></i>Apply Now
                        </button>
                    </div>
                </div>
            </div>
        `;
        container.innerHTML += jobCard;
    });
}



// Job search functionality
function handleJobSearch() {
    const searchTerm = document.getElementById('jobs-search-input').value.toLowerCase().trim();
    if (searchTerm.length >= 2) {
        performJobSearch();
    } else if (searchTerm.length === 0) {
        displayJobs(allJobs);
    }
}

function performJobSearch() {
    const searchTerm = document.getElementById('jobs-search-input').value.toLowerCase().trim();
    
    if (!searchTerm) {
        displayJobs(allJobs);
        return;
    }
    
    const filteredJobs = allJobs.filter(job => 
        job.title.toLowerCase().includes(searchTerm) ||
        job.company.toLowerCase().includes(searchTerm) ||
        job.location.toLowerCase().includes(searchTerm) ||
        job.description.toLowerCase().includes(searchTerm) ||
        job.jobType.toLowerCase().includes(searchTerm)
    );
    
    displayJobs(filteredJobs);
    
    if (filteredJobs.length === 0) {
        showToast('No jobs found matching your search', 'info');
    }
}

async function loadCompanies() {
    const companies = [
    	{
    		"name": "Google",
    		"logo": "https://cdn.pixabay.com/photo/2015/12/11/11/43/google-1088004_1280.png",
    		"jobs": "50+ Open Roles"
    		},
    		{
    		"name": "Microsoft",
    		"logo": "https://cdn.pixabay.com/photo/2013/02/12/09/07/microsoft-80658_1280.png",
    		"jobs": "45+ Open Roles"
    		},
    		{
    		"name": "Apple",
    		"logo": "https://cdn.pixabay.com/photo/2013/02/12/09/07/apple-80658_1280.png",
    		"jobs": "35+ Open Roles"
    		},
    		{
    		"name": "Amazon",
    		"logo": "https://cdn.pixabay.com/photo/2018/05/08/21/28/amazon-3384010_1280.png",
    		"jobs": "60+ Open Roles"
    		},
    		
    		{
    		"name": "Intel",
    		"logo": "https://cdn.pixabay.com/photo/2013/02/12/09/07/intel-80660_1280.png",
    		"jobs": "28+ Open Roles"
    		},
    		{
    		"name": "IBM",
    		"logo": "https://cdn.pixabay.com/photo/2018/05/08/21/29/ibm-3384015_1280.png",
    		"jobs": "42+ Open Roles"
    		}
    		
    ];
    
    const container = document.getElementById('companies-slider');
    companies.forEach(company => {
        const companyCard = `
            <div class="col-6 col-md-4 col-lg-2">
                <div class="company-slide">
                    <img src="${company.logo}" alt="${company.name}" class="img-fluid mb-3" style="height: 60px; object-fit: contain;">
                    <h6 class="fw-bold mb-2">${company.name}</h6>
                    <small class="text-muted d-block mb-2">${company.jobs}</small>
                    <button class="btn btn-outline-primary btn-sm" onclick="showSection('jobs')">View Jobs</button>
                </div>
            </div>
        `;
        container.innerHTML += companyCard;
    });
}

async function loadUserProfile() {
    if (currentUser) {
        try {
            // Fetch fresh user data from backend
            const response = await fetch('/user/profile');
            const data = await response.json();
            
            if (data.success) {
                const userData = data.data;
                
                // Update profile section
                document.getElementById('profile-full-name').textContent = userData.fullName;
                document.getElementById('profile-email').textContent = userData.email;
                document.getElementById('profile-address').textContent = userData.address;
                document.getElementById('profile-phone').textContent = userData.phone;
                
                // Update info table
                document.getElementById('info-full-name').textContent = userData.fullName;
                document.getElementById('info-email').textContent = userData.email;
                document.getElementById('info-address').textContent = userData.address;
                document.getElementById('info-phone').textContent = userData.phone;
                document.getElementById('info-joined').textContent = userData.memberSince || userData.createdAt || 'Recently joined';
                
                // Update profile photo
                const profilePhotoEl = document.getElementById('profile-photo');
                const navbarPhotoEl = document.getElementById('navbar-profile-photo');
                if (userData.profilePhotoPath) {
                    profilePhotoEl.src = userData.profilePhotoPath;
                    navbarPhotoEl.src = userData.profilePhotoPath;
                } else {
                    const placeholder = 'https://via.placeholder.com/180x180/4361ee/ffffff?text=Profile';
                    profilePhotoEl.src = placeholder;
                    navbarPhotoEl.src = 'https://via.placeholder.com/36x36/4361ee/ffffff?text=U';
                }
                
                console.log("✅ User profile loaded:", userData);
            }
        } catch (error) {
            console.error("❌ Error loading user profile:", error);
            // Fallback to currentUser data
            document.getElementById('profile-full-name').textContent = currentUser.fullName || 'User';
            document.getElementById('profile-email').textContent = currentUser.email || 'No email';
            document.getElementById('profile-address').textContent = currentUser.address || 'Not set';
            document.getElementById('profile-phone').textContent = currentUser.phone || 'Not set';
            
            document.getElementById('info-full-name').textContent = currentUser.fullName || 'User';
            document.getElementById('info-email').textContent = currentUser.email || 'No email';
            document.getElementById('info-address').textContent = currentUser.address || 'Not set';
            document.getElementById('info-phone').textContent = currentUser.phone || 'Not set';
            document.getElementById('info-joined').textContent = 'Recently joined';
        }
    }
}

async function loadUserApplications() {
    try {
        const applications = await ApiService.getUserApplications();
        displayUserApplications(applications);
    } catch (error) {
        console.error('Failed to load applications:', error);
    }
}

function displayUserApplications(applications) {
    const tbody = document.querySelector('#applications-table tbody');
    tbody.innerHTML = '';
    
    if (!applications || applications.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="text-center py-4">
                    <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No applications yet</h5>
                    <p class="text-muted">Apply for jobs to see them here</p>
                </td>
            </tr>
        `;
        return;
    }
    
    applications.forEach(app => {
        // Find the job details for this application
        const job = allJobs.find(j => j.id === app.jobId);
        const companyName = job ? job.company : 'Company';
        const jobTitle = job ? job.title : 'Position';
        
        const row = `
            <tr>
                <td class="fw-bold">${jobTitle}</td>
                <td>${companyName}</td>
                <td>${new Date(app.appliedAt).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })}</td>
                <td>
                    <span class="status-badge status-${app.status.toLowerCase()}">
                        ${app.status}
                    </span>
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="viewCV('${app.cvFileId}')">
                        <i class="fas fa-eye me-1"></i>View CV
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

// Job application functions
// Job application functions
function showApplyModal(jobId) {
    if (!currentUser) {
        showToast('Please login to apply for jobs', 'warning');
        showLoginModal();
        return;
    }
    
    closeCurrentModal();
    document.getElementById('apply-job-id').value = jobId;
    
    // Auto-fill user details
    document.getElementById('apply-fullname').value = currentUser.fullName || '';
    document.getElementById('apply-email').value = currentUser.email || '';
    document.getElementById('apply-phone').value = currentUser.phone || '';
    document.getElementById('apply-address').value = currentUser.address || '';
    
    const modalElement = document.getElementById('applyJobModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

// Fixed Apply Job Form Handler
document.getElementById('apply-job-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const jobId = document.getElementById('apply-job-id').value;
    const cvFile = document.getElementById('apply-cv').files[0];
    
    if (!cvFile) {
        showToast('Please select a CV file', 'warning');
        return;
    }
    
    // Validate file type
    const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
    if (!allowedTypes.includes(cvFile.type)) {
        showToast('Please select a PDF or image file (JPEG, JPG, PNG)', 'error');
        return;
    }
    
    // Validate file size (10MB)
    if (cvFile.size > 10 * 1024 * 1024) {
        showToast('File size must be less than 10MB', 'error');
        return;
    }
    
    const formData = new FormData();
    formData.append('jobId', jobId);
    formData.append('cv', cvFile);
    
    try {
        showToast('Submitting application...', 'info');
        
        const response = await fetch('/apply-job', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message, 'success');
            closeCurrentModal();
            document.getElementById('apply-job-form').reset();
            
            // Reload user applications
            if (currentUser) {
                loadUserApplications();
            }
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        console.error('Application error:', error);
        showToast('Application failed. Please try again.', 'error');
    }
});
// Photo upload
async function uploadPhoto(file) {
    if (!file) return;
    
    // Validate file type
    const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
    if (!allowedTypes.includes(file.type)) {
        showToast('Please select a valid image file (JPEG, JPG, PNG, GIF)', 'error');
        return;
    }
    
    try {
        const data = await ApiService.uploadPhoto(file);
        
        if (data.success) {
            showToast(data.message, 'success');
            checkAuth();
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Photo upload failed.', 'error');
    }
}

// CV viewing function
// CV viewing function - Fixed version
async function viewCV(cvFileId) {
    if (!cvFileId) {
        showToast('CV file not found', 'warning');
        return;
    }
    
    try {
        console.log("📄 Viewing CV with ID:", cvFileId);
        
        // If it's a file path (starts with /uploads/)
        if (cvFileId.startsWith('/uploads/')) {
            const fileName = cvFileId.substring('/uploads/'.length());
            showCVPreview(`/uploads/${fileName}`, 'application/pdf');
        } 
        // If it's a MongoDB file ID
        else {
            const result = await ApiService.getCVFile(cvFileId);
            if (result.success) {
                currentCVFile = result.file;
                showCVPreview(result.url, result.type);
            } else {
                showToast(result.message, 'error');
            }
        }
    } catch (error) {
        console.error('❌ Error viewing CV:', error);
        showToast('Failed to load CV: ' + error.message, 'error');
    }
}

function determineFileType(filename) {
    if (filename.toLowerCase().endsWith('.pdf')) {
        return 'application/pdf';
    } else if (filename.toLowerCase().endsWith('.jpg') || filename.toLowerCase().endsWith('.jpeg')) {
        return 'image/jpeg';
    } else if (filename.toLowerCase().endsWith('.png')) {
        return 'image/png';
    } else {
        return 'application/pdf'; // Default to PDF
    }
}

function showCVPreview(fileUrl, fileType, isLoading = false) {
    closeCurrentModal();
    
    const imagePreview = document.getElementById('cv-preview-image');
    const pdfPreview = document.getElementById('cv-preview-pdf');
    const placeholder = document.getElementById('cv-preview-placeholder');
    const loading = document.getElementById('cv-preview-loading');
    
    // Hide all first
    imagePreview.style.display = 'none';
    pdfPreview.style.display = 'none';
    placeholder.style.display = 'none';
    if (loading) loading.style.display = 'none';
    
    if (isLoading) {
        // Show loading state
        if (loading) {
            loading.style.display = 'block';
        } else {
            // Create loading element if it doesn't exist
            const loadingHtml = `
                <div id="cv-preview-loading" class="text-center">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p>Loading CV...</p>
                </div>
            `;
            document.getElementById('cv-preview-container').innerHTML += loadingHtml;
            document.getElementById('cv-preview-loading').style.display = 'block';
        }
    } else if (fileUrl && fileType) {
        if (fileType === 'application/pdf') {
            pdfPreview.src = fileUrl;
            pdfPreview.style.display = 'block';
            console.log("📊 PDF preview shown:", fileUrl);
        } else if (fileType.startsWith('image/')) {
            imagePreview.src = fileUrl;
            imagePreview.style.display = 'block';
            console.log("🖼️ Image preview shown:", fileUrl);
        } else {
            placeholder.style.display = 'block';
            console.log("❓ Unknown file type, showing placeholder");
        }
    } else {
        placeholder.style.display = 'block';
        console.log("❌ No file data, showing placeholder");
    }
    
    const modalElement = document.getElementById('viewCVModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

function downloadCV() {
    if (!currentCVFile || !currentCVFile.url) {
        showToast('No CV file available to download', 'warning');
        return;
    }
    
    try {
        const link = document.createElement('a');
        link.href = currentCVFile.url;
        link.download = currentCVFile.name;
        link.target = '_blank';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showToast('CV download started', 'success');
    } catch (error) {
        console.error('❌ Download error:', error);
        showToast('Failed to download CV', 'error');
    }
}
// Search functionality for home page
function searchJobs() {
    const query = document.getElementById('search-input').value.toLowerCase().trim();
    if (!query) {
        displayJobs(allJobs);
        return;
    }
    
    const filteredJobs = allJobs.filter(job => 
        job.title.toLowerCase().includes(query) ||
        job.company.toLowerCase().includes(query) ||
        job.location.toLowerCase().includes(query) ||
        job.description.toLowerCase().includes(query) ||
        job.jobType.toLowerCase().includes(query)
    );
    
    displayJobs(filteredJobs);
    showSection('jobs');
    
    if (filteredJobs.length === 0) {
        showToast('No jobs found matching your search', 'info');
    }
}

// Location detection with place name
function getLocation() {
    if (navigator.geolocation) {
        showToast('Detecting your location...', 'info');
        navigator.geolocation.getCurrentPosition(
            async (position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                
                try {
                    // Use reverse geocoding to get place name
                    const response = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=en`);
                    const data = await response.json();
                    
                    const address = data.locality || data.city || data.principalSubdivision || 'Your current location';
                    document.getElementById('signup-address').value = address;
                    showToast('Location detected successfully!', 'success');
                } catch (error) {
                    // Fallback to coordinates if reverse geocoding fails
                    document.getElementById('signup-address').value = `Lat: ${lat.toFixed(4)}, Lng: ${lng.toFixed(4)}`;
                    showToast('Location detected (coordinates)', 'success');
                }
            },
            (error) => {
                console.error('Geolocation error:', error);
                let message = 'Unable to get your location';
                if (error.code === error.PERMISSION_DENIED) {
                    message = 'Location access denied. Please enable location services.';
                } else if (error.code === error.TIMEOUT) {
                    message = 'Location detection timeout. Please try again.';
                }
                showToast(message, 'warning');
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            }
        );
    } else {
        showToast('Geolocation is not supported by your browser', 'warning');
    }
}

// Admin functions
function showAdminPanel() {
    document.querySelectorAll('.section-content').forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById('admin-section').classList.add('active');
    loadAdminData();
}

function adminLogout() {
    logout();
}

async function loadAdminData() {
    try {
        const dashboard = await ApiService.getAdminDashboard();
        
        document.getElementById('total-users').textContent = dashboard.totalUsers;
        document.getElementById('total-jobs').textContent = dashboard.totalJobs;
        document.getElementById('total-applications').textContent = dashboard.totalApplications;
        document.getElementById('pending-applications').textContent = dashboard.pendingApplications;
        
        const users = await ApiService.getAllUsers();
        displayUsers(users);
        
        const applications = await ApiService.getAllApplications();
        displayAdminApplications(applications);
        
    } catch (error) {
        console.error('Failed to load admin data:', error);
        showToast('Failed to load admin data', 'error');
    }
}

function displayUsers(users) {
    const tbody = document.getElementById('users-table');
    tbody.innerHTML = '';
    
    users.forEach(user => {
        const row = `
            <tr>
                <td class="fw-bold">${user.fullName}</td>
                <td>${user.email}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="editUserEmail(${user.id}, '${user.email}')">
                        <i class="fas fa-edit"></i>
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

function displayAdminApplications(applications) {
    const tbody = document.getElementById('admin-applications-table');
    tbody.innerHTML = '';
    
    if (!applications || applications.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <i class="fas fa-file-alt fa-2x text-muted mb-2"></i>
                    <p class="text-muted">No applications found</p>
                </td>
            </tr>
        `;
        return;
    }
    
    applications.forEach(app => {
        // Handle different CV path formats
        let cvPath = '';
        if (app.cvFileId) {
            cvPath = app.cvFileId;
        } else if (app.cvPath) {
            cvPath = app.cvPath;
        } else if (app.cvFilePath) {
            cvPath = app.cvFilePath;
        }
        
        const row = `
            <tr>
                <td class="fw-bold">${app.userId || 'N/A'}</td>
                <td>${app.jobId || 'N/A'}</td>
                <td>${new Date(app.appliedAt).toLocaleDateString()}</td>
                <td>
                    <select class="form-select form-select-sm" onchange="updateApplicationStatus('${app.id}', this.value)">
                        <option value="Pending" ${app.status === 'Pending' ? 'selected' : ''}>Pending</option>
                        <option value="Success" ${app.status === 'Success' ? 'selected' : ''}>Success</option>
                        <option value="Rejected" ${app.status === 'Rejected' ? 'selected' : ''}>Rejected</option>
                    </select>
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="viewCV('${cvPath}')" ${!cvPath ? 'disabled' : ''}>
                        <i class="fas fa-eye me-1"></i>View CV
                    </button>
                </td>
                <td>
                    <span class="badge bg-${app.status === 'Pending' ? 'warning' : app.status === 'Success' ? 'success' : 'danger'}">
                        ${app.status || 'Unknown'}
                    </span>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

function editUserEmail(userId, currentEmail) {
    closeCurrentModal();
    document.getElementById('edit-user-id').value = userId;
    document.getElementById('edit-user-email').value = currentEmail;
    
    const modalElement = document.getElementById('editEmailModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

async function updateApplicationStatus(applicationId, status) {
    try {
        const data = await ApiService.updateApplicationStatus(applicationId, status);
        
        if (data.success) {
            showToast(data.message, 'success');
            if (data.notification) {
                showToast(data.notification, 'info');
            }
            loadAdminData();
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Status update failed.', 'error');
    }
}
//Toggle Job Status (Active/Inactive)
async function toggleJobStatus(jobId, currentStatus) {
    try {
        const formData = new FormData();
        formData.append('jobId', jobId);
        
        const response = await fetch('/admin/toggle-job-status', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message, 'success');
            loadAdminData(); // Refresh the data
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Failed to update job status: ' + error.message, 'error');
    }
}

// Enhanced Add Job Form Handler
document.getElementById('add-job-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const title = document.getElementById('job-title').value.trim();
    const description = document.getElementById('job-description').value.trim();
    const company = document.getElementById('job-company').value.trim();
    const location = document.getElementById('job-location').value.trim();
    const salary = document.getElementById('job-salary').value.trim();
    const jobType = document.getElementById('job-type').value;
    const companyLogo = document.getElementById('company-logo').files[0];
    
    // Basic validation
    if (!title) {
        showToast('Job title is required', 'error');
        return;
    }
    if (!company) {
        showToast('Company name is required', 'error');
        return;
    }
    if (!jobType) {
        showToast('Please select job type', 'error');
        return;
    }
    
    const formData = new FormData();
    formData.append('title', title);
    formData.append('description', description);
    formData.append('company', company);
    formData.append('location', location);
    formData.append('salary', salary);
    formData.append('jobType', jobType);
    
    if (companyLogo) {
        formData.append('companyLogo', companyLogo);
    }
    
    // Show loading state
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Adding Job...';
    submitBtn.disabled = true;
    
    try {
        const response = await fetch('/admin/add-job', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message, 'success');
            this.reset(); // Clear form
            loadAdminData(); // Refresh admin data
            
            // Close modal if open
            const modal = bootstrap.Modal.getInstance(document.getElementById('add-job-modal'));
            if (modal) {
                modal.hide();
            }
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Failed to add job: ' + error.message, 'error');
    } finally {
        // Restore button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});

// Enhanced CV Viewing in Popup
// CV viewing function - Working implementation
async function viewCV(cvFileId) {
    if (!cvFileId) {
        showToast('CV file not found', 'warning');
        return;
    }
    
    try {
        console.log('📁 Loading CV with fileId:', cvFileId);
        
        // Check if it's a local file path or MongoDB file ID
        if (cvFileId.startsWith('/uploads/') || cvFileId.startsWith('/api/files/')) {
            // It's already a file path, show directly
            showCVPreview(cvFileId, getFileTypeFromPath(cvFileId));
        } else {
            // It's a MongoDB file ID, get the file info
            const response = await fetch(`/files/${cvFileId}`);
            if (response.ok) {
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                const fileType = response.headers.get('content-type') || 'application/pdf';
                showCVPreview(url, fileType);
            } else {
                throw new Error('CV not found');
            }
        }
    } catch (error) {
        console.error('❌ Error viewing CV:', error);
        showToast('Failed to load CV: ' + error.message, 'error');
    }
}

function showCVPreview(fileUrl, fileType) {
    console.log('🖼️ Showing CV preview:', fileUrl, fileType);
    
    closeCurrentModal();
    
    // Get or create modal elements
    let imagePreview = document.getElementById('cv-preview-image');
    let pdfPreview = document.getElementById('cv-preview-pdf');
    let placeholder = document.getElementById('cv-preview-placeholder');
    
    // Create elements if they don't exist
    const container = document.getElementById('cv-preview-container');
    if (!container) {
        console.error('❌ CV preview container not found');
        showToast('CV preview container not found', 'error');
        return;
    }
    
    // Ensure all elements exist
    if (!imagePreview) {
        imagePreview = document.createElement('img');
        imagePreview.id = 'cv-preview-image';
        imagePreview.className = 'cv-preview';
        imagePreview.style.display = 'none';
        container.appendChild(imagePreview);
    }
    
    if (!pdfPreview) {
        pdfPreview = document.createElement('iframe');
        pdfPreview.id = 'cv-preview-pdf';
        pdfPreview.style.display = 'none';
        pdfPreview.style.width = '100%';
        pdfPreview.style.height = '600px';
        pdfPreview.style.border = 'none';
        container.appendChild(pdfPreview);
    }
    
    if (!placeholder) {
        placeholder = document.createElement('div');
        placeholder.id = 'cv-preview-placeholder';
        placeholder.className = 'text-muted';
        placeholder.innerHTML = `
            <i class="fas fa-file-alt fa-5x mb-3"></i>
            <h5>CV Preview</h5>
            <p>Select a CV file to preview</p>
        `;
        container.appendChild(placeholder);
    }
    
    // Hide all elements first
    imagePreview.style.display = 'none';
    pdfPreview.style.display = 'none';
    placeholder.style.display = 'none';
    
    // Show appropriate preview based on file type
    if (fileType === 'application/pdf' || fileUrl.toLowerCase().endsWith('.pdf')) {
        pdfPreview.src = fileUrl;
        pdfPreview.style.display = 'block';
        console.log('📄 Showing PDF preview');
    } else if (fileType.startsWith('image/') || 
               fileUrl.toLowerCase().match(/\.(jpg|jpeg|png|gif|bmp|webp)$/)) {
        imagePreview.src = fileUrl;
        imagePreview.style.display = 'block';
        console.log('🖼️ Showing image preview');
    } else {
        placeholder.style.display = 'block';
        console.log('📄 Showing placeholder - unknown file type:', fileType);
    }
    
    // Store current CV file for download
    currentCVFile = {
        url: fileUrl,
        type: fileType,
        name: 'CV_' + Date.now() + (fileType === 'application/pdf' ? '.pdf' : '.jpg')
    };
    
    const modalElement = document.getElementById('viewCVModal');
    if (modalElement) {
        currentModal = modalElement;
        const modal = new bootstrap.Modal(modalElement);
        modal.show();
    } else {
        console.error('❌ View CV modal not found');
        showToast('CV preview modal not found', 'error');
    }
}

function getFileTypeFromPath(filePath) {
    if (filePath.toLowerCase().endsWith('.pdf')) {
        return 'application/pdf';
    } else if (filePath.toLowerCase().endsWith('.jpg') || filePath.toLowerCase().endsWith('.jpeg')) {
        return 'image/jpeg';
    } else if (filePath.toLowerCase().endsWith('.png')) {
        return 'image/png';
    } else if (filePath.toLowerCase().endsWith('.gif')) {
        return 'image/gif';
    } else {
        return 'application/octet-stream';
    }
}

function downloadCV() {
    if (!currentCVFile || !currentCVFile.url) {
        showToast('No CV file to download', 'warning');
        return;
    }
    
    try {
        const link = document.createElement('a');
        link.href = currentCVFile.url;
        link.download = currentCVFile.name;
        link.target = '_blank';
        
        // Append to body, click, and remove
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Revoke object URL after download
        if (currentCVFile.url.startsWith('blob:')) {
            setTimeout(() => URL.revokeObjectURL(currentCVFile.url), 100);
        }
        
        showToast('CV download started', 'success');
    } catch (error) {
        console.error('❌ Download error:', error);
        showToast('Download failed: ' + error.message, 'error');
    }
}
// Enhanced Admin Jobs Display
function displayAdminJobs(jobs) {
    const container = document.getElementById('admin-jobs-container');
    if (!container) {
        // Create jobs container if it doesn't exist
        const adminApplicationsSection = document.querySelector('.profile-section');
        const jobsSection = `
            <div class="profile-section mt-4">
                <h5 class="fw-bold mb-4">
                    <i class="fas fa-briefcase me-2"></i>Manage Jobs
                </h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-custom">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Company</th>
                                <th>Location</th>
                                <th>Salary</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admin-jobs-table">
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        adminApplicationsSection.insertAdjacentHTML('afterend', jobsSection);
    }
    
    const tbody = document.getElementById('admin-jobs-table');
    tbody.innerHTML = '';
    
    if (!jobs || jobs.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <i class="fas fa-briefcase fa-2x text-muted mb-2"></i>
                    <p class="text-muted">No jobs found</p>
                </td>
            </tr>
        `;
        return;
    }
    
    jobs.forEach(job => {
        const isActive = job.active !== false; // Default to true if not specified
        const statusText = isActive ? 'Active' : 'Inactive';
        const statusBadge = isActive ? 'success' : 'danger';
        const toggleText = isActive ? 'Deactivate' : 'Activate';
        const toggleIcon = isActive ? 'fa-pause' : 'fa-play';
        
        const row = `
            <tr>
                <td class="fw-bold">${job.title || 'N/A'}</td>
                <td>${job.company || 'N/A'}</td>
                <td>${job.location || 'N/A'}</td>
                <td>${job.salary || 'N/A'}</td>
                <td>${job.jobType || 'N/A'}</td>
                <td>
                    <span class="badge bg-${statusBadge}">${statusText}</span>
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" onclick="toggleJobStatus(${job.id}, ${isActive})" 
                                title="${toggleText} Job">
                            <i class="fas ${toggleIcon}"></i>
                        </button>
                        <button class="btn btn-outline-danger" onclick="deleteJob(${job.id})" title="Delete Job">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

//Admin Dashboard Functions
async function loadAdminData() {
    try {
        console.log("🔄 Loading admin data...");
        
        // Load dashboard stats
        const dashboardResponse = await fetch('/admin/dashboard');
        const dashboardData = await dashboardResponse.json();
        
        if (dashboardData.success) {
            const stats = dashboardData.data;
            document.getElementById('total-users').textContent = stats.totalUsers || 0;
            document.getElementById('total-jobs').textContent = stats.totalJobs || 0;
            document.getElementById('total-applications').textContent = stats.totalApplications || 0;
            document.getElementById('pending-applications').textContent = stats.pendingApplications || 0;
            console.log("✅ Dashboard stats loaded:", stats);
        } else {
            console.error("❌ Failed to load dashboard:", dashboardData.message);
        }
        
        // Load all users
        const usersResponse = await fetch('/admin/users');
        const usersData = await usersResponse.json();
        
        if (usersData.success) {
            displayUsers(usersData.data);
            console.log("✅ Users loaded:", usersData.data.length);
        } else {
            console.error("❌ Failed to load users:", usersData.message);
        }
        
        // Load all applications
        const appsResponse = await fetch('/admin/applications');
        const appsData = await appsResponse.json();
        
        if (appsResponse.ok) {
            displayAdminApplications(appsData.data || appsData);
            console.log("✅ Applications loaded:", (appsData.data || appsData).length);
        } else {
            console.error("❌ Failed to load applications:", appsData.message);
        }
        
        // Load all jobs for admin
        const jobsResponse = await fetch('/admin/jobs');
        const jobsData = await jobsResponse.json();
        
        if (jobsData.success) {
            displayAdminJobs(jobsData.data);
            console.log("✅ Jobs loaded for admin:", jobsData.data.length);
        } else {
            console.error("❌ Failed to load jobs for admin:", jobsData.message);
        }
        
    } catch (error) {
        console.error('❌ Error loading admin data:', error);
        showToast('Failed to load admin data', 'error');
    }
}

function displayUsers(users) {
    const tbody = document.getElementById('users-table');
    tbody.innerHTML = '';
    
    if (!users || users.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="3" class="text-center py-4">
                    <i class="fas fa-users fa-2x text-muted mb-2"></i>
                    <p class="text-muted">No users found</p>
                </td>
            </tr>
        `;
        return;
    }
    
    users.forEach(user => {
        const row = `
            <tr>
                <td class="fw-bold">${user.fullName || 'N/A'}</td>
                <td>${user.email || 'N/A'}</td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="editUserEmail(${user.id}, '${user.email}')">
                        <i class="fas fa-edit"></i> Edit Email
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

function displayAdminApplications(applications) {
    const tbody = document.getElementById('admin-applications-table');
    tbody.innerHTML = '';
    
    if (!applications || applications.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <i class="fas fa-file-alt fa-2x text-muted mb-2"></i>
                    <p class="text-muted">No applications found</p>
                </td>
            </tr>
        `;
        return;
    }
    
    applications.forEach(app => {
        const row = `
            <tr>
                <td class="fw-bold">${app.userId || 'N/A'}</td>
                <td>${app.jobId || 'N/A'}</td>
                <td>${new Date(app.appliedAt).toLocaleDateString()}</td>
                <td>
                    <select class="form-select form-select-sm" onchange="updateApplicationStatus('${app.id}', this.value)">
                        <option value="Pending" ${app.status === 'Pending' ? 'selected' : ''}>Pending</option>
                        <option value="Success" ${app.status === 'Success' ? 'selected' : ''}>Success</option>
                        <option value="Rejected" ${app.status === 'Rejected' ? 'selected' : ''}>Rejected</option>
                    </select>
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-primary" onclick="viewCV('${app.cvFileId}')">
                        <i class="fas fa-eye me-1"></i>View CV
                    </button>
                </td>
                <td>
                    <span class="badge bg-${app.status === 'Pending' ? 'warning' : app.status === 'Success' ? 'success' : 'danger'}">
                        ${app.status || 'Unknown'}
                    </span>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

function displayAdminJobs(jobs) {
    const container = document.getElementById('admin-jobs-container');
    if (!container) {
        // Create jobs container if it doesn't exist
        const adminSection = document.getElementById('admin-section');
        const jobsSection = `
            <div class="profile-section mt-4">
                <h5 class="fw-bold mb-4">
                    <i class="fas fa-briefcase me-2"></i>Manage Jobs
                </h5>
                <div class="table-responsive">
                    <table class="table table-bordered table-custom">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Company</th>
                                <th>Location</th>
                                <th>Salary</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="admin-jobs-table">
                        </tbody>
                    </table>
                </div>
            </div>
        `;
        adminSection.innerHTML += jobsSection;
    }
    
    const tbody = document.getElementById('admin-jobs-table');
    tbody.innerHTML = '';
    
    if (!jobs || jobs.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4">
                    <i class="fas fa-briefcase fa-2x text-muted mb-2"></i>
                    <p class="text-muted">No jobs found</p>
                </td>
            </tr>
        `;
        return;
    }
    
    jobs.forEach(job => {
        const row = `
            <tr>
                <td class="fw-bold">${job.title || 'N/A'}</td>
                <td>${job.company || 'N/A'}</td>
                <td>${job.location || 'N/A'}</td>
                <td>${job.salary || 'N/A'}</td>
                <td>${job.jobType || 'N/A'}</td>
                <td>
                    <span class="badge bg-${job.active ? 'success' : 'danger'}">
                        ${job.active ? 'Active' : 'Inactive'}
                    </span>
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editJob(${job.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" onclick="deleteJob(${job.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

// Edit User Email
function editUserEmail(userId, currentEmail) {
    closeCurrentModal();
    document.getElementById('edit-user-id').value = userId;
    document.getElementById('edit-user-email').value = currentEmail;
    
    const modalElement = document.getElementById('editEmailModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

// Update Application Status
async function updateApplicationStatus(applicationId, status) {
    try {
        const formData = new FormData();
        formData.append('applicationId', applicationId);
        formData.append('status', status);
        
        const response = await fetch('/admin/update-application-status', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message, 'success');
            if (data.notification) {
                showToast(data.notification, 'info');
            }
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Status update failed: ' + error.message, 'error');
    }
}

// Edit Job Function
function editJob(jobId) {
    // Implement job editing modal
    showToast('Edit job feature coming soon!', 'info');
}

// Delete Job Function
async function deleteJob(jobId) {
    if (confirm('Are you sure you want to delete this job?')) {
        try {
            const formData = new FormData();
            formData.append('jobId', jobId);
            
            const response = await fetch('/admin/delete-job', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            
            if (data.success) {
                showToast(data.message, 'success');
                loadAdminData(); // Refresh data
            } else {
                showToast(data.message, 'error');
            }
        } catch (error) {
            showToast('Failed to delete job: ' + error.message, 'error');
        }
    }
}

// Add Job Form Handler
document.getElementById('add-job-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData();
    formData.append('title', document.getElementById('job-title').value);
    formData.append('description', document.getElementById('job-description').value);
    formData.append('company', document.getElementById('job-company').value);
    formData.append('location', document.getElementById('job-location').value);
    formData.append('salary', document.getElementById('job-salary').value);
    formData.append('jobType', document.getElementById('job-type').value);
    
    const companyLogo = document.getElementById('company-logo').files[0];
    if (companyLogo) {
        formData.append('companyLogo', companyLogo);
    }
    
    try {
        const response = await fetch('/admin/add-job', {
            method: 'POST',
            body: formData
        });
        const data = await response.json();
        
        if (data.success) {
            showToast(data.message, 'success');
            this.reset();
            loadAdminData(); // Refresh admin data
        } else {
            showToast(data.message, 'error');
        }
    } catch (error) {
        showToast('Failed to add job: ' + error.message, 'error');
    }
});
// Logout function
async function logout() {
    try {
        const data = await ApiService.logout();
        
        if (data.success) {
            showToast(data.message, 'success');
            closeCurrentModal();
            currentUser = null;
            isAdmin = false;
            showAuthButtons();
            document.getElementById('main-navbar').classList.remove('d-none');
            showSection('home');
        }
    } catch (error) {
        showToast('Logout failed.', 'error');
    }
}

// Utility functions
// Utility functions - Enhanced Toast
function showToast(message, type = 'info') {
    const background = {
        success: 'linear-gradient(135deg, #00b09b, #96c93d)',
        error: 'linear-gradient(135deg, #ff5f6d, #ffc371)',
        warning: 'linear-gradient(135deg, #f46b45, #eea849)',
        info: 'linear-gradient(135deg, #4facfe, #00f2fe)'
    };
    
    Toastify({
        text: message,
        duration: 4000,
        gravity: "top",
        position: "right",
        stopOnFocus: true,
        style: {
            background: background[type] || background.info,
            borderRadius: '10px',
            boxShadow: '0 5px 15px rgba(0,0,0,0.2)',
            fontFamily: 'Poppins, sans-serif',
            fontWeight: '500',
            padding: '12px 20px'
        }
    }).showToast();
}
// Initialize animations
setTimeout(() => {
    const fadeElements = document.querySelectorAll('.fade-in');
    fadeElements.forEach((element, index) => {
        element.style.animationDelay = `${index * 0.1}s`;
    });
}, 100);

//Admin Add Job Form Handler - COMPLETELY FIXED
document.getElementById('add-job-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    console.log("🆕 Add job form submitted");
    
    // Get form values
    const title = document.getElementById('job-title').value;
    const description = document.getElementById('job-description').value;
    const company = document.getElementById('job-company').value;
    const location = document.getElementById('job-location').value;
    const salary = document.getElementById('job-salary').value;
    const jobType = document.getElementById('job-type').value;
    const companyLogo = document.getElementById('company-logo').files[0];
    
    console.log("📝 Form data:", { title, company, location, salary, jobType, hasLogo: !!companyLogo });
    
    // Validate required fields
    if (!title.trim()) {
        showToast('Job title is required', 'error');
        return;
    }
    
    if (!company.trim()) {
        showToast('Company name is required', 'error');
        return;
    }
    
    // Create form data
    const formData = new FormData();
    formData.append('title', title);
    formData.append('description', description);
    formData.append('company', company);
    formData.append('location', location);
    formData.append('salary', salary);
    formData.append('jobType', jobType);
    
    if (companyLogo) {
        formData.append('companyLogo', companyLogo);
        console.log("🖼️ Logo file:", companyLogo.name, companyLogo.size, companyLogo.type);
    }
    
    try {
        console.log("🚀 Sending job creation request...");
        const response = await fetch('/admin/add-job', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        console.log("📨 Server response:", data);
        
        if (data.success) {
            showToast(data.message, 'success');
            console.log("✅ Job created successfully:", data.jobId);
            
            // Reset form
            this.reset();
            
            // Refresh admin data
            await loadAdminData();
            
            // Also refresh jobs list for users
            await loadJobs();
            
        } else {
            showToast(data.message, 'error');
            console.error("❌ Job creation failed:", data.message);
        }
    } catch (error) {
        console.error('❌ Network error:', error);
        showToast('Failed to add job: ' + error.message, 'error');
    }
});

// Enhanced Admin Data Loading
async function loadAdminData() {
    try {
        console.log("🔄 Loading admin data...");
        
        // Load dashboard stats
        const dashboardResponse = await fetch('/admin/dashboard');
        const dashboardData = await dashboardResponse.json();
        
        if (dashboardData.success) {
            const stats = dashboardData.data;
            document.getElementById('total-users').textContent = stats.totalUsers || 0;
            document.getElementById('total-jobs').textContent = stats.totalJobs || 0;
            document.getElementById('total-applications').textContent = stats.totalApplications || 0;
            document.getElementById('pending-applications').textContent = stats.pendingApplications || 0;
            console.log("✅ Dashboard stats loaded:", stats);
        } else {
            console.error("❌ Failed to load dashboard:", dashboardData.message);
            showToast('Failed to load dashboard', 'error');
        }
        
        // Load all users
        const usersResponse = await fetch('/admin/users');
        const usersData = await usersResponse.json();
        
        if (usersData.success) {
            displayUsers(usersData.data);
            console.log("✅ Users loaded:", usersData.data.length);
        } else {
            console.error("❌ Failed to load users:", usersData.message);
        }
        
        // Load all applications
        const appsResponse = await fetch('/admin/applications');
        const appsData = await appsResponse.json();
        
        if (appsData.success) {
            displayAdminApplications(appsData.data);
            console.log("✅ Applications loaded:", appsData.data.length);
        } else {
            console.error("❌ Failed to load applications:", appsData.message);
        }
        
        // Load all jobs for admin
        const jobsResponse = await fetch('/admin/jobs');
        const jobsData = await jobsResponse.json();
        
        if (jobsData.success) {
            displayAdminJobs(jobsData.data);
            console.log("✅ Jobs loaded for admin:", jobsData.data.length);
        } else {
            console.error("❌ Failed to load jobs for admin:", jobsData.message);
        }
        
    } catch (error) {
        console.error('❌ Error loading admin data:', error);
        showToast('Failed to load admin data', 'error');
    }
}

// Display Admin Jobs
// ==============================================
// ENHANCED JOB CARD DISPLAY WITH REAL LOGOS
// Add this at the END of your existing JavaScript
// ==============================================

// Enhanced job card display with real company logos
function displayJobs(jobs) {
    const container = document.getElementById('jobs-list');
    container.innerHTML = '';
    
    if (!jobs || jobs.length === 0) {
        container.innerHTML = `
            <div class="col-12">
                <div class="text-center py-5">
                    <i class="fas fa-search fa-4x text-muted mb-4"></i>
                    <h3 class="text-muted">No jobs found</h3>
                    <p class="text-muted">Try adjusting your search criteria</p>
                </div>
            </div>
        `;
        return;
    }
    
    const row = document.createElement('div');
    row.className = 'row g-4';
    
    jobs.forEach((job, index) => {
        const jobCard = createJobCard(job, index);
        row.innerHTML += jobCard;
    });
    
    container.appendChild(row);
    animateJobCards();
}

// Create individual job card with real logos
function createJobCard(job, index) {
    const logoContent = getLogoContent(job);
    
    return `
        <div class="col-12 col-md-6 col-lg-4">
            <div class="job-card-wrapper">
                <div class="job-card card h-100" data-job-id="${job.id}">
                    <div class="card-body d-flex flex-column">
                        <!-- Company Logo/Photo Section -->
                        <div class="company-logo-section mb-3">
                            ${logoContent}
                            <div class="company-info">
                                <h6 class="mb-0 fw-bold text-truncate">${job.company}</h6>
                                <small class="text-muted">
                                    <i class="fas fa-map-marker-alt me-1"></i>${job.location}
                                </small>
                            </div>
                        </div>
                        
                        <!-- Job Title -->
                        <h5 class="card-title fw-bold text-primary mb-2">${job.title}</h5>
                        
                        <!-- Job Description -->
                        <p class="card-text text-muted flex-grow-1 job-description">
                            ${job.description ? job.description.substring(0, 120) + '...' : 'No description available'}
                        </p>
                        
                        <!-- Job Meta Information -->
                        <div class="job-meta mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-primary px-3 py-2">${job.jobType || 'Full-time'}</span>
                                <strong class="text-success fs-6">${job.salary || 'Salary not specified'}</strong>
                            </div>
                        </div>
                        
                        <!-- Apply Button -->
                        <button class="btn btn-primary w-100 mt-auto apply-btn" onclick="showApplyModal(${job.id})">
                            <i class="fas fa-paper-plane me-2"></i>Apply Now
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Real company logo URLs
const companyLogos = {
    'google': 'https://logos-download.com/wp-content/uploads/2016/02/Google_Logo_2015.png',
    'microsoft': 'https://logos-download.com/wp-content/uploads/2016/02/Microsoft_logo_2012.png',
    'apple': 'https://logos-download.com/wp-content/uploads/2016/02/Apple_Logo_1977.png',
    'amazon': 'https://logos-download.com/wp-content/uploads/2016/03/Amazon_Logo_2000.png',
    'meta': 'https://logos-download.com/wp-content/uploads/2021/10/Meta_Platforms_Inc_logo.png',
    'facebook': 'https://logos-download.com/wp-content/uploads/2016/09/Facebook_logo_F-2015.png',
    'netflix': 'https://logos-download.com/wp-content/uploads/2016/03/Netflix_Logo_2014.png',
    'tesla': 'https://logos-download.com/wp-content/uploads/2016/10/Tesla_logo_red.png',
    'spotify': 'https://logos-download.com/wp-content/uploads/2016/06/Spotify_logo_horizontal_black.png',
    'twitter': 'https://logos-download.com/wp-content/uploads/2016/02/Twitter_Logo_Blue.png',
    'linkedin': 'https://logos-download.com/wp-content/uploads/2016/03/LinkedIn_Logo_2019.png',
    'github': 'https://logos-download.com/wp-content/uploads/2019/01/GitHub_Logo.png',
    'instagram': 'https://logos-download.com/wp-content/uploads/2016/05/Instagram_logo_2016.png',
    'youtube': 'https://logos-download.com/wp-content/uploads/2016/10/YouTube_logo_2017.png',
    'whatsapp': 'https://logos-download.com/wp-content/uploads/2016/10/WhatsApp_logo.png',
    'adobe': 'https://logos-download.com/wp-content/uploads/2016/10/Adobe_logo_black_red.png',
    'salesforce': 'https://logos-download.com/wp-content/uploads/2016/09/Salesforce_logo.png',
    'uber': 'https://logos-download.com/wp-content/uploads/2016/09/Uber_logo_white.png',
    'airbnb': 'https://logos-download.com/wp-content/uploads/2016/03/Airbnb_logo.png',
    'slack': 'https://logos-download.com/wp-content/uploads/2016/10/Slack_logo.png',
    'shopify': 'https://logos-download.com/wp-content/uploads/2016/10/Shopify_logo_2018.png',
    'paypal': 'https://logos-download.com/wp-content/uploads/2016/10/PayPal_logo_logotype_emblem.png'
};

// Determine logo content - real logo if available, otherwise admin photo or icon
function getLogoContent(job) {
    if (!job || !job.company) {
        return `
            <div class="company-logo-icon">
                <i class="fas fa-building"></i>
            </div>
        `;
    }
    
    const companyName = job.company.toLowerCase();
    
    // First check if admin uploaded a company logo
    if (job.companyLogoPath && job.companyLogoPath.trim() !== '') {
        return `
            <div class="company-logo-photo">
                <img src="${job.companyLogoPath}" 
                     alt="${job.company}" 
                     class="company-logo-img"
                     onerror="handleLogoError(this)">
            </div>
        `;
    }
    
    // Check for real company logo
    const logoKey = Object.keys(companyLogos).find(key => 
        companyName.includes(key)
    );
    
    if (logoKey) {
        return `
            <div class="company-logo-photo">
                <img src="${companyLogos[logoKey]}" 
                     alt="${job.company}" 
                     class="company-logo-img real-logo"
                     onerror="handleLogoError(this)">
            </div>
        `;
    }
    
    // No logo available, show icon based on company name
    return `
        <div class="company-logo-icon">
            ${getCompanyIcon(job.company)}
        </div>
    `;
}

// Handle logo loading errors
function handleLogoError(imgElement) {
    const companyName = imgElement.alt.toLowerCase();
    const logoKey = Object.keys(companyLogos).find(key => 
        companyName.includes(key)
    );
    
    if (logoKey && imgElement.src !== companyLogos[logoKey]) {
        // Try real logo as fallback
        imgElement.src = companyLogos[logoKey];
        imgElement.classList.add('real-logo');
    } else {
        // Fallback to icon
        const iconHTML = getCompanyIcon(imgElement.alt);
        const iconDiv = document.createElement('div');
        iconDiv.className = 'company-logo-icon';
        iconDiv.innerHTML = iconHTML;
        imgElement.parentElement.replaceWith(iconDiv);
    }
}

// Get appropriate icon based on company name
function getCompanyIcon(companyName) {
    if (!companyName) return '<i class="fas fa-building"></i>';
    
    const company = companyName.toLowerCase();
    
    if (company.includes('google')) {
        return '<i class="fab fa-google"></i>';
    } else if (company.includes('microsoft')) {
        return '<i class="fab fa-microsoft"></i>';
    } else if (company.includes('apple')) {
        return '<i class="fab fa-apple"></i>';
    } else if (company.includes('amazon')) {
        return '<i class="fab fa-amazon"></i>';
    } else if (company.includes('facebook') || company.includes('meta')) {
        return '<i class="fab fa-facebook"></i>';
    } else if (company.includes('netflix')) {
        return '<i class="fab fa-netflix"></i>';
    } else if (company.includes('tesla')) {
        return '<i class="fas fa-bolt"></i>';
    } else if (company.includes('spotify')) {
        return '<i class="fab fa-spotify"></i>';
    } else if (company.includes('twitter')) {
        return '<i class="fab fa-twitter"></i>';
    } else if (company.includes('linkedin')) {
        return '<i class="fab fa-linkedin"></i>';
    } else if (company.includes('github')) {
        return '<i class="fab fa-github"></i>';
    } else if (company.includes('instagram')) {
        return '<i class="fab fa-instagram"></i>';
    } else if (company.includes('youtube')) {
        return '<i class="fab fa-youtube"></i>';
    } else if (company.includes('whatsapp')) {
        return '<i class="fab fa-whatsapp"></i>';
    } else if (company.includes('adobe')) {
        return '<i class="fab fa-adobe"></i>';
    } else if (company.includes('salesforce')) {
        return '<i class="fab fa-salesforce"></i>';
    } else if (company.includes('uber')) {
        return '<i class="fab fa-uber"></i>';
    } else if (company.includes('airbnb')) {
        return '<i class="fab fa-airbnb"></i>';
    } else if (company.includes('slack')) {
        return '<i class="fab fa-slack"></i>';
    } else if (company.includes('shopify')) {
        return '<i class="fab fa-shopify"></i>';
    } else if (company.includes('paypal')) {
        return '<i class="fab fa-paypal"></i>';
    } else if (company.includes('digital') || company.includes('tech') || company.includes('software')) {
        return '<i class="fas fa-laptop-code"></i>';
    } else if (company.includes('bank') || company.includes('finance') || company.includes('capital')) {
        return '<i class="fas fa-university"></i>';
    } else if (company.includes('medical') || company.includes('health') || company.includes('hospital')) {
        return '<i class="fas fa-hospital"></i>';
    } else if (company.includes('education') || company.includes('school') || company.includes('university')) {
        return '<i class="fas fa-graduation-cap"></i>';
    } else if (company.includes('restaurant') || company.includes('food') || company.includes('cafe')) {
        return '<i class="fas fa-utensils"></i>';
    } else if (company.includes('store') || company.includes('retail') || company.includes('shop')) {
        return '<i class="fas fa-shopping-bag"></i>';
    } else if (company.includes('car') || company.includes('auto') || company.includes('vehicle')) {
        return '<i class="fas fa-car"></i>';
    } else if (company.includes('travel') || company.includes('tour') || company.includes('hotel')) {
        return '<i class="fas fa-plane"></i>';
    } else {
        return '<i class="fas fa-building"></i>';
    }
}

// Animation for job cards
function animateJobCards() {
    const jobCards = document.querySelectorAll('.job-card');
    
    jobCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.6s ease-out';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
}

// Enhanced CSS for job cards with real logos
const jobCardStyles = `
    /* Company Logo Section */
    .company-logo-section {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    /* Company Logo with Photo */
    .company-logo-photo {
        position: relative;
        width: 70px;
        height: 70px;
        flex-shrink: 0;
    }
    
    .company-logo-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        border-radius: 12px;
        background: white;
        padding: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }
    
    .company-logo-img.real-logo {
        background: white;
        padding: 6px;
    }
    
    .company-logo-img:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.2);
        border-color: #4361ee;
    }
    
    /* Company Logo with Icon */
    .company-logo-icon {
        width: 70px;
        height: 70px;
        border-radius: 12px;
        background: linear-gradient(135deg, #4361ee, #3a0ca3);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        transition: all 0.3s ease;
        flex-shrink: 0;
    }
    
    .company-logo-icon:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }
    
    /* Company Info */
    .company-info {
        flex: 1;
        min-width: 0;
    }
    
    .company-info h6 {
        color: #2d3748;
        font-size: 1rem;
    }
    
    .company-info small {
        font-size: 0.85rem;
    }
    
    /* Job Card Base Styles */
    .job-card-wrapper {
        position: relative;
        margin-bottom: 2rem;
    }
    
    .job-card {
        border: none;
        border-radius: 16px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(67, 97, 238, 0.1);
    }
    
    .job-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 16px 35px rgba(67, 97, 238, 0.15);
        border-color: rgba(67, 97, 238, 0.3);
    }
    
    .job-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(135deg, #4361ee, #3a0ca3);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }
    
    .job-card:hover::before {
        transform: scaleX(1);
    }
    
    /* Job Description */
    .job-description {
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        color: #6c757d;
        font-size: 0.9rem;
    }
    
    /* Job Meta Information */
    .job-meta {
        padding: 12px;
        background: rgba(67, 97, 238, 0.03);
        border-radius: 10px;
        border-left: 3px solid #4361ee;
    }
    
    .job-meta .badge {
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .job-meta .text-success {
        font-weight: 700;
        font-size: 0.9rem;
    }
    
    /* Apply Button */
    .apply-btn {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        font-weight: 600;
        letter-spacing: 0.5px;
        border-radius: 10px;
        padding: 10px 20px;
        background: linear-gradient(135deg, #4361ee, #3a0ca3);
        border: none;
    }
    
    .apply-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s ease;
    }
    
    .apply-btn:hover::before {
        left: 100%;
    }
    
    .apply-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .job-card-wrapper {
            margin-bottom: 1.5rem;
        }
        
        .company-logo-section {
            gap: 10px;
        }
        
        .company-logo-photo,
        .company-logo-icon {
            width: 60px;
            height: 60px;
        }
        
        .company-logo-icon {
            font-size: 1.3rem;
        }
        
        .company-info h6 {
            font-size: 0.9rem;
        }
        
        .company-info small {
            font-size: 0.8rem;
        }
    }
    
    /* Animation for new job cards */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .job-card {
        animation: fadeInUp 0.6s ease-out;
    }
`;

// Inject styles into the document
function injectJobCardStyles() {
    if (!document.getElementById('job-card-styles')) {
        const styleElement = document.createElement('style');
        styleElement.id = 'job-card-styles';
        styleElement.textContent = jobCardStyles;
        document.head.appendChild(styleElement);
    }
}

// Enhanced search function
function performJobSearch() {
    const searchTerm = document.getElementById('jobs-search-input').value.toLowerCase().trim();
    const jobCards = document.querySelectorAll('.job-card');
    
    if (!searchTerm) {
        jobCards.forEach((card, index) => {
            card.parentElement.parentElement.style.display = 'block';
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
        return;
    }
    
    let visibleCount = 0;
    
    jobCards.forEach((card, index) => {
        const jobTitle = card.querySelector('.card-title').textContent.toLowerCase();
        const company = card.querySelector('.company-info h6').textContent.toLowerCase();
        const location = card.querySelector('.company-info small').textContent.toLowerCase();
        const description = card.querySelector('.job-description').textContent.toLowerCase();
        
        const matchesSearch = jobTitle.includes(searchTerm) || 
                            company.includes(searchTerm) || 
                            location.includes(searchTerm) ||
                            description.includes(searchTerm);
        
        const jobWrapper = card.parentElement.parentElement;
        
        if (matchesSearch) {
            jobWrapper.style.display = 'block';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
            visibleCount++;
        } else {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                jobWrapper.style.display = 'none';
            }, 300);
        }
    });
    
    showNoResultsMessage(visibleCount === 0);
}

function showNoResultsMessage(show) {
    let noResultsDiv = document.getElementById('no-results-message');
    
    if (show && !noResultsDiv) {
        noResultsDiv = document.createElement('div');
        noResultsDiv.id = 'no-results-message';
        noResultsDiv.className = 'col-12 text-center py-5';
        noResultsDiv.innerHTML = `
            <div class="no-results-animation">
                <i class="fas fa-search fa-4x text-muted mb-4"></i>
                <h3 class="text-muted mb-3">No jobs found</h3>
                <p class="text-muted mb-4">Try adjusting your search terms</p>
                <button class="btn btn-outline-primary" onclick="clearSearch()">
                    <i class="fas fa-times me-2"></i>Clear Search
                </button>
            </div>
        `;
        document.getElementById('jobs-list').appendChild(noResultsDiv);
    } else if (!show && noResultsDiv) {
        noResultsDiv.remove();
    }
}

function clearSearch() {
    document.getElementById('jobs-search-input').value = '';
    performJobSearch();
}

// Initialize when page loads - only if not already initialized
document.addEventListener('DOMContentLoaded', function() {
    if (typeof injectJobCardStyles === 'function') {
        injectJobCardStyles();
    }
});

// Handle job search input
function handleJobSearch() {
    const searchTerm = document.getElementById('jobs-search-input').value.toLowerCase().trim();
    if (searchTerm.length >= 2 || searchTerm.length === 0) {
        performJobSearch();
    }
}

// ==============================================
// END OF ENHANCED JOB CARD DISPLAY
// ==============================================








//pdfEnhanced Certificate and MCQ Test System with MongoDB Simulation
const EnhancedCertificateSystem = {
    // Storage keys for MongoDB simulation
    STORAGE_KEYS: {
        CERTIFICATES: 'jobportal_certificates_v2',
        TEST_ATTEMPTS: 'jobportal_test_attempts_v2',
        QUESTIONS: 'jobportal_mcq_questions_v2',
        ASSESSMENT_SESSIONS: 'jobportal_assessment_sessions'
    },

    // Initialize certificate system
    init() {
        this.initializeQuestions();
        this.initializeStorage();
    },

    // Initialize storage
    initializeStorage() {
        const defaultStorage = {
            [this.STORAGE_KEYS.CERTIFICATES]: [],
            [this.STORAGE_KEYS.TEST_ATTEMPTS]: {},
            [this.STORAGE_KEYS.ASSESSMENT_SESSIONS]: {}
        };

        Object.keys(defaultStorage).forEach(key => {
            if (!localStorage.getItem(key)) {
                localStorage.setItem(key, JSON.stringify(defaultStorage[key]));
            }
        });
    },

    // Enhanced questions with time-based complexity
    initializeQuestions() {
        const enhancedQuestions = [
            {
                id: this.generateMongoId(),
                question: "What is the primary purpose of version control systems like Git?",
                options: [
                    "To track changes in source code",
                    "To compile code automatically", 
                    "To deploy applications",
                    "To design user interfaces"
                ],
                correctAnswer: 0,
                category: "Version Control",
                difficulty: "Easy"
            },
            {
                id: this.generateMongoId(),
                question: "Which HTTP method is idempotent and should be used for retrieving resources?",
                options: [
                    "POST",
                    "GET",
                    "PUT", 
                    "DELETE"
                ],
                correctAnswer: 1,
                category: "Web Development",
                difficulty: "Easy"
            },
            {
                id: this.generateMongoId(),
                question: "What is the time complexity of accessing an element in an array by index?",
                options: [
                    "O(1)",
                    "O(n)",
                    "O(log n)",
                    "O(n²)"
                ],
                correctAnswer: 0,
                category: "Algorithms",
                difficulty: "Medium"
            },
            {
                id: this.generateMongoId(),
                question: "Which of these is NOT a JavaScript framework?",
                options: [
                    "React",
                    "Vue",
                    "Django",
                    "Angular"
                ],
                correctAnswer: 2,
                category: "Web Development", 
                difficulty: "Easy"
            },
            {
                id: this.generateMongoId(),
                question: "What does the 'SOLID' principle in object-oriented design stand for?",
                options: [
                    "Single Responsibility, Open-Closed, Liskov Substitution, Interface Segregation, Dependency Inversion",
                    "Simple, Organized, Logical, Integrated, Dynamic",
                    "Structured, Object-oriented, Layered, Interface-driven, Decoupled",
                    "Systematic, Optimized, Logical, Interface-based, Distributed"
                ],
                correctAnswer: 0,
                category: "Software Design",
                difficulty: "Hard"
            },
            {
                id: this.generateMongoId(),
                question: "Which database type is best suited for complex transactions and ACID properties?",
                options: [
                    "NoSQL databases",
                    "Graph databases",
                    "Relational databases",
                    "Document databases"
                ],
                correctAnswer: 2,
                category: "Database",
                difficulty: "Medium"
            },
            {
                id: this.generateMongoId(),
                question: "What is the main advantage of using Docker containers?",
                options: [
                    "They make applications faster",
                    "They provide environment consistency across deployments",
                    "They replace virtual machines completely", 
                    "They automatically scale applications"
                ],
                correctAnswer: 1,
                category: "DevOps",
                difficulty: "Medium"
            },
            {
                id: this.generateMongoId(),
                question: "In REST API design, what should HTTP status code 201 indicate?",
                options: [
                    "Successful request",
                    "Resource created successfully",
                    "Request accepted for processing",
                    "Resource updated successfully"
                ],
                correctAnswer: 1,
                category: "API Design",
                difficulty: "Medium"
            },
            {
                id: this.generateMongoId(),
                question: "Which algorithm is used for shortest path finding in graphs?",
                options: [
                    "Bubble Sort",
                    "Dijkstra's Algorithm", 
                    "Binary Search",
                    "Quick Sort"
                ],
                correctAnswer: 1,
                category: "Algorithms",
                difficulty: "Hard"
            },
            {
                id: this.generateMongoId(),
                question: "What is the purpose of JWT (JSON Web Tokens) in authentication?",
                options: [
                    "To encrypt database connections",
                    "To securely transmit information between parties as JSON objects",
                    "To compress API responses",
                    "To validate email addresses"
                ],
                correctAnswer: 1,
                category: "Security",
                difficulty: "Medium"
            }
        ];

        if (!localStorage.getItem(this.STORAGE_KEYS.QUESTIONS)) {
            localStorage.setItem(this.STORAGE_KEYS.QUESTIONS, JSON.stringify(enhancedQuestions));
        }
    },

    // MongoDB-like ID generation
    generateMongoId() {
        const timestamp = Math.floor(new Date().getTime() / 1000).toString(16);
        const randomValue = Math.floor(Math.random() * 16777215).toString(16);
        return timestamp + '0'.repeat(8) + randomValue;
    },

    // Get questions
    getQuestions() {
        return JSON.parse(localStorage.getItem(this.STORAGE_KEYS.QUESTIONS) || '[]');
    },

    // Check if user can take test with 5-minute time limit and 24-hour retry
    canTakeTest(userId) {
        const attempts = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.TEST_ATTEMPTS) || '{}');
        const sessions = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS) || '{}');
        const userAttempts = attempts[userId] || [];
        const userSession = sessions[userId];

        // Check for active session (5-minute time limit)
        if (userSession && userSession.active) {
            const sessionStart = new Date(userSession.startTime);
            const now = new Date();
            const minutesElapsed = (now - sessionStart) / (1000 * 60);
            
            if (minutesElapsed < 5) {
                return { canTake: true, activeSession: true, timeRemaining: 5 - minutesElapsed };
            } else {
                // Auto-submit if time expired
                this.autoSubmitExpiredSession(userId);
            }
        }

        // Check 24-hour retry policy
        if (userAttempts.length > 0) {
            const lastAttempt = userAttempts[userAttempts.length - 1];
            const lastAttemptDate = new Date(lastAttempt.timestamp);
            const now = new Date();
            const hoursDiff = (now - lastAttemptDate) / (1000 * 60 * 60);

            if (lastAttempt.passed) {
                return { canTake: false, reason: 'already_passed', nextAvailable: null };
            } else if (hoursDiff < 24) {
                const nextAvailable = new Date(lastAttemptDate.getTime() + (24 * 60 * 60 * 1000));
                return { canTake: false, reason: 'retry_cooldown', nextAvailable };
            }
        }

        return { canTake: true, activeSession: false, timeRemaining: null };
    },

    // Start assessment session with 5-minute timer
    startAssessmentSession(userId) {
        const sessions = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS) || '{}');
        sessions[userId] = {
            active: true,
            startTime: new Date().toISOString(),
            questions: [],
            userAnswers: [],
            timeLimit: 5 // 5 minutes
        };
        localStorage.setItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS, JSON.stringify(sessions));
    },

    // Update session with answers
    updateAssessmentSession(userId, questionIndex, answer) {
        const sessions = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS) || '{}');
        if (sessions[userId]) {
            sessions[userId].userAnswers[questionIndex] = answer;
            localStorage.setItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS, JSON.stringify(sessions));
        }
    },

    // End assessment session
    endAssessmentSession(userId) {
        const sessions = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS) || '{}');
        if (sessions[userId]) {
            sessions[userId].active = false;
            sessions[userId].endTime = new Date().toISOString();
            localStorage.setItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS, JSON.stringify(sessions));
        }
    },

    // Auto-submit expired session
    autoSubmitExpiredSession(userId) {
        const sessions = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.ASSESSMENT_SESSIONS) || '{}');
        const session = sessions[userId];
        
        if (session && session.active) {
            this.endAssessmentSession(userId);
            // Calculate score based on completed answers
            const completedAnswers = session.userAnswers.filter(answer => answer !== null && answer !== undefined);
            if (completedAnswers.length > 0) {
                this.processTestResults(userId, session.questions, completedAnswers);
            }
        }
    },

    // Process test results
    processTestResults(userId, questions, userAnswers) {
        let correctAnswers = 0;
        questions.forEach((question, index) => {
            if (userAnswers[index] === question.correctAnswer) {
                correctAnswers++;
            }
        });

        const score = (correctAnswers / questions.length) * 100;
        const passed = score >= 80;

        this.saveTestAttempt(userId, score, passed, questions.length);

        if (passed) {
            this.generateCertificate(userId, this.getUserName(userId), score, correctAnswers, questions.length);
        }

        return { score, passed, correctAnswers, totalQuestions: questions.length };
    },

    // Get user name (simulated)
    getUserName(userId) {
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        return currentUser.fullName || 'User';
    },

    // Save test attempt
    saveTestAttempt(userId, score, passed, totalQuestions) {
        const attempts = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.TEST_ATTEMPTS) || '{}');
        if (!attempts[userId]) {
            attempts[userId] = [];
        }
        
        attempts[userId].push({
            _id: this.generateMongoId(),
            userId: userId,
            timestamp: new Date().toISOString(),
            score: score,
            passed: passed,
            totalQuestions: totalQuestions,
            correctAnswers: Math.round((score / 100) * totalQuestions)
        });
        
        localStorage.setItem(this.STORAGE_KEYS.TEST_ATTEMPTS, JSON.stringify(attempts));
    },

    // Generate certificate with MongoDB-like storage
    generateCertificate(userId, userName, score, correctAnswers, totalQuestions) {
        const certificate = {
            _id: this.generateMongoId(),
            userId: userId,
            userName: userName,
            score: score,
            correctAnswers: correctAnswers,
            totalQuestions: totalQuestions,
            issueDate: new Date().toISOString(),
            certificateNumber: `CC-${Date.now().toString().slice(-8)}-${Math.random().toString(36).substr(2, 4).toUpperCase()}`,
            status: 'active',
            verificationUrl: `${window.location.origin}/verify/${this.generateMongoId()}`,
            metadata: {
                generatedBy: 'CareerConnect Assessment System',
                version: '2.0',
                template: 'professional_blue'
            }
        };
        
        const certificates = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.CERTIFICATES) || '[]');
        certificates.push(certificate);
        localStorage.setItem(this.STORAGE_KEYS.CERTIFICATES, JSON.stringify(certificates));
        
        return certificate;
    },

    // Get user certificates
    getUserCertificates(userId) {
        const certificates = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.CERTIFICATES) || '[]');
        return certificates.filter(cert => cert.userId === userId && cert.status === 'active');
    },

    // Get certificate by ID
    getCertificateById(certificateId) {
        const certificates = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.CERTIFICATES) || '[]');
        return certificates.find(cert => cert._id === certificateId);
    },

    // Get total certificates count for user
    getTotalCertificates(userId) {
        const certificates = this.getUserCertificates(userId);
        return certificates.length;
    },

    // Verify certificate (MongoDB simulation)
    verifyCertificate(certificateId) {
        const certificate = this.getCertificateById(certificateId);
        if (!certificate) {
            return { valid: false, message: 'Certificate not found' };
        }

        return {
            valid: true,
            certificate: {
                userName: certificate.userName,
                score: certificate.score,
                issueDate: certificate.issueDate,
                certificateNumber: certificate.certificateNumber,
                status: certificate.status
            },
            message: 'Certificate is valid and verified'
        };
    },

    // Get user test history
    getUserTestHistory(userId) {
        const attempts = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.TEST_ATTEMPTS) || '{}');
        return attempts[userId] || [];
    }
};

// Enhanced MCQ Test System with Timer
let currentTestSession = {
    questions: [],
    currentQuestionIndex: 0,
    userAnswers: [],
    startTime: null,
    timer: null,
    timeRemaining: 5 * 60 // 5 minutes in seconds
};

// Show Enhanced MCQ Test Modal
function showEnhancedMCQTestModal() {
    if (!currentUser) {
        showToast('Please login to take the test', 'warning');
        showLoginModal();
        return;
    }

    // Check if user can take test
    const testEligibility = EnhancedCertificateSystem.canTakeTest(currentUser.id);
    
    if (!testEligibility.canTake) {
        if (testEligibility.reason === 'already_passed') {
            showToast('You have already passed the test!', 'info');
        } else if (testEligibility.reason === 'retry_cooldown') {
            const nextTimeStr = testEligibility.nextAvailable.toLocaleString();
            showToast(`You can retry the test after: ${nextTimeStr}`, 'warning');
        }
        return;
    }

    closeCurrentModal();
    
    // Create Enhanced MCQ Test Modal HTML
    const modalHTML = `
        <div class="modal fade" id="enhancedMCQTestModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content modal-custom">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-graduation-cap me-2"></i>CareerConnect Skills Assessment
                        </h5>
                        <div id="test-timer" class="badge bg-danger fs-6">
                            <i class="fas fa-clock me-1"></i><span id="time-display">05:00</span>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div id="test-content">
                            <div class="text-center" id="test-start-screen">
                                <div class="step-icon mx-auto mb-3" style="width: 80px; height: 80px;">
                                    <i class="fas fa-brain"></i>
                                </div>
                                <h4 class="fw-bold mb-2">Technical Skills Assessment</h4>
                                <p class="text-muted mb-4">Test your knowledge and earn a verified certificate</p>
                                
                                <div class="row mb-4">
                                    <div class="col-md-6 mb-3">
                                        <div class="info-card text-center p-3 rounded-3 bg-light">
                                            <i class="fas fa-question-circle fa-2x text-primary mb-2"></i>
                                            <h6 class="fw-bold">10 Questions</h6>
                                            <small class="text-muted">Multiple Choice</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="info-card text-center p-3 rounded-3 bg-light">
                                            <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                                            <h6 class="fw-bold">5 Minutes</h6>
                                            <small class="text-muted">Time Limit</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    <strong>Important:</strong> 
                                    <ul class="mb-0 mt-2">
                                        <li>You have <strong>5 minutes</strong> to complete all questions</li>
                                        <li>Need <strong>80% or higher</strong> to pass</li>
                                        <li>Failed attempts can be retried after <strong>24 hours</strong></li>
                                        <li>Timer cannot be paused once started</li>
                                    </ul>
                                </div>
                                
                                <button class="btn btn-primary btn-lg px-5" onclick="startEnhancedMCQTest()">
                                    <i class="fas fa-play me-2"></i>Start Assessment
                                </button>
                            </div>
                            
                            <div id="test-questions-screen" style="display: none;">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <div>
                                        <h6 class="mb-0">Question <span id="current-question">1</span>/10</h6>
                                        <small class="text-muted" id="question-category">Category</small>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <div class="progress" style="width: 120px; height: 8px;">
                                            <div id="test-progress" class="progress-bar" style="width: 0%"></div>
                                        </div>
                                        <span class="badge bg-secondary ms-2" id="difficulty-badge">Easy</span>
                                    </div>
                                </div>
                                
                                <div id="questions-container">
                                    <!-- Questions will be loaded here -->
                                </div>
                                
                                <div class="d-flex justify-content-between mt-4">
                                    <button class="btn btn-outline-primary" id="prev-question-btn" onclick="prevQuestion()" style="display: none;">
                                        <i class="fas fa-arrow-left me-2"></i>Previous
                                    </button>
                                    <button class="btn btn-primary" id="next-question-btn" onclick="nextQuestion()">
                                        Next Question <i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;

    // Add modal to body if not exists
    if (!document.getElementById('enhancedMCQTestModal')) {
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }

    const modalElement = document.getElementById('enhancedMCQTestModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
    
    // Prevent closing modal during test
    modalElement.addEventListener('hide.bs.modal', function (event) {
        if (document.getElementById('test-questions-screen').style.display !== 'none') {
            event.preventDefault();
            showToast('Cannot close modal during active assessment', 'warning');
        }
    });
}













//PDF Resume Generator
function generatePDFResume() {
    const fullName = document.getElementById('resume-fullname').value;
    const email = document.getElementById('resume-email').value;
    const phone = document.getElementById('resume-phone').value;
    const address = document.getElementById('resume-address').value;
    const summary = document.getElementById('resume-summary').value;
    const skills = document.getElementById('resume-skills').value;
    const experience = document.getElementById('resume-experience').value;
    const education = document.getElementById('resume-education').value;

    // Validation
    if (!fullName || !email) {
        showToast('Please fill at least Name and Email fields', 'warning');
        return;
    }

    // Create PDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Set initial y position
    let yPosition = 20;
    
    // Add background color for header
    doc.setFillColor(67, 97, 238);
    doc.rect(0, 0, 210, 40, 'F');
    
    // Header - Name
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(24);
    doc.setFont('helvetica', 'bold');
    doc.text(fullName, 105, 25, { align: 'center' });
    
    // Contact Information
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    
    const contactInfo = [];
    if (email) contactInfo.push(email);
    if (phone) contactInfo.push(phone);
    if (address) contactInfo.push(address);
    
    doc.text(contactInfo.join(' • '), 105, 35, { align: 'center' });
    
    yPosition = 50;
    doc.setTextColor(0, 0, 0);
    
    // Professional Summary
    if (summary) {
        addSectionHeader(doc, 'PROFESSIONAL SUMMARY', yPosition);
        yPosition += 10;
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        const splitSummary = doc.splitTextToSize(summary, 180);
        doc.text(splitSummary, 15, yPosition);
        yPosition += (splitSummary.length * 5) + 10;
    }
    
    // Skills
    if (skills) {
        addSectionHeader(doc, 'SKILLS', yPosition);
        yPosition += 10;
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        const skillsArray = skills.split(',').map(skill => skill.trim());
        const skillsPerLine = 3;
        
        for (let i = 0; i < skillsArray.length; i += skillsPerLine) {
            const lineSkills = skillsArray.slice(i, i + skillsPerLine);
            const skillText = lineSkills.map(skill => `• ${skill}`).join('   ');
            doc.text(skillText, 15, yPosition);
            yPosition += 6;
        }
        yPosition += 5;
    }
    
    // Experience
    if (experience) {
        addSectionHeader(doc, 'EXPERIENCE', yPosition);
        yPosition += 10;
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text(`• ${experience} years of professional experience`, 15, yPosition);
        yPosition += 15;
    }
    
    // Education
    if (education) {
        addSectionHeader(doc, 'EDUCATION', yPosition);
        yPosition += 10;
        
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        const splitEducation = doc.splitTextToSize(education, 180);
        doc.text(splitEducation, 15, yPosition);
        yPosition += (splitEducation.length * 5) + 10;
    }
    
    // Add footer
    doc.setFontSize(8);
    doc.setTextColor(128, 128, 128);
    doc.text('Generated by CareerConnect - Your Dream Job Awaits!', 105, 290, { align: 'center' });
    
    // Save PDF
    const fileName = `${fullName.replace(/\s+/g, '_')}_Resume.pdf`;
    doc.save(fileName);
    
    showToast('Resume downloaded successfully as PDF!', 'success');
}

function addSectionHeader(doc, text, yPosition) {
    doc.setFillColor(67, 97, 238);
    doc.rect(10, yPosition - 5, 190, 8, 'F');
    
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'bold');
    doc.text(text, 15, yPosition + 2);
    
    doc.setTextColor(0, 0, 0);
}

// Enhanced Build Resume Modal with PDF Option
function showBuildResumeModal() {
    closeCurrentModal();
    
    if (currentUser) {
        document.getElementById('resume-fullname').value = currentUser.fullName || '';
        document.getElementById('resume-email').value = currentUser.email || '';
        document.getElementById('resume-phone').value = currentUser.phone || '';
        document.getElementById('resume-address').value = currentUser.address || '';
    }
    
    const modalElement = document.getElementById('buildResumeModal');
    currentModal = modalElement;
    const modal = new bootstrap.Modal(modalElement);
    modal.show();
}

// Enhanced Build Resume Form Handler
document.getElementById('build-resume-form').addEventListener('submit', function(e) {
    e.preventDefault();
    generatePDFResume();
    closeCurrentModal();
});

// Add sample data button for testing
function addSampleResumeData() {
    document.getElementById('resume-fullname').value = 'John Doe';
    document.getElementById('resume-email').value = 'john.doe@example.com';
    document.getElementById('resume-phone').value = '+1 (555) 123-4567';
    document.getElementById('resume-address').value = '123 Main Street, New York, NY 10001';
    document.getElementById('resume-summary').value = 'Experienced software developer with 5+ years in web development. Strong problem-solving skills and passion for creating efficient, scalable applications. Proficient in JavaScript, React, Node.js, and cloud technologies.';
    document.getElementById('resume-skills').value = 'JavaScript, React, Node.js, Python, MongoDB, AWS, Docker, Git';
    document.getElementById('resume-experience').value = '5';
    document.getElementById('resume-education').value = 'Bachelor of Science in Computer Science - University of Technology (2015-2019)\nGPA: 3.8/4.0';
    
    showToast('Sample data loaded! Fill in your actual information.', 'info');
}

// Enhanced Resume Builder UI with Templates
function enhanceResumeBuilder() {
    const buildResumeForm = document.getElementById('build-resume-form');
    if (buildResumeForm) {
        // Add template selection
        const templateSection = `
            <div class="mb-4">
                <label class="form-label fw-bold">Choose Resume Template</label>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="template-card border rounded-3 p-3 text-center cursor-pointer" onclick="selectTemplate('professional')">
                            <div class="bg-primary text-white rounded-2 p-2 mb-2">
                                <i class="fas fa-briefcase fa-2x"></i>
                            </div>
                            <h6 class="mb-1">Professional</h6>
                            <small class="text-muted">Clean & Corporate</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="template-card border rounded-3 p-3 text-center cursor-pointer" onclick="selectTemplate('modern')">
                            <div class="bg-success text-white rounded-2 p-2 mb-2">
                                <i class="fas fa-rocket fa-2x"></i>
                            </div>
                            <h6 class="mb-1">Modern</h6>
                            <small class="text-muted">Creative & Bold</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="template-card border rounded-3 p-3 text-center cursor-pointer" onclick="selectTemplate('minimal')">
                            <div class="bg-warning text-white rounded-2 p-2 mb-2">
                                <i class="fas fa-leaf fa-2x"></i>
                            </div>
                            <h6 class="mb-1">Minimal</h6>
                            <small class="text-muted">Simple & Elegant</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <button type="button" class="btn btn-outline-info btn-sm" onclick="addSampleResumeData()">
                    <i class="fas fa-magic me-2"></i>Load Sample Data
                </button>
            </div>
        `;
        
        buildResumeForm.insertAdjacentHTML('afterbegin', templateSection);
    }
}

let selectedTemplate = 'professional';

function selectTemplate(template) {
    selectedTemplate = template;
    
    // Remove active class from all templates
    document.querySelectorAll('.template-card').forEach(card => {
        card.classList.remove('border-primary', 'border-2');
        card.classList.add('border');
    });
    
    // Add active class to selected template
    event.currentTarget.classList.remove('border');
    event.currentTarget.classList.add('border-primary', 'border-2');
    
    showToast(`${template.charAt(0).toUpperCase() + template.slice(1)} template selected`, 'info');
}

// Enhanced PDF Generation with Templates
function generateEnhancedPDFResume() {
    const fullName = document.getElementById('resume-fullname').value;
    const email = document.getElementById('resume-email').value;
    const phone = document.getElementById('resume-phone').value;
    const address = document.getElementById('resume-address').value;
    const summary = document.getElementById('resume-summary').value;
    const skills = document.getElementById('resume-skills').value;
    const experience = document.getElementById('resume-experience').value;
    const education = document.getElementById('resume-education').value;

    if (!fullName || !email) {
        showToast('Please fill at least Name and Email fields', 'warning');
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    switch (selectedTemplate) {
        case 'professional':
            generateProfessionalResume(doc, fullName, email, phone, address, summary, skills, experience, education);
            break;
        case 'modern':
            generateModernResume(doc, fullName, email, phone, address, summary, skills, experience, education);
            break;
        case 'minimal':
            generateMinimalResume(doc, fullName, email, phone, address, summary, skills, experience, education);
            break;
        default:
            generateProfessionalResume(doc, fullName, email, phone, address, summary, skills, experience, education);
    }
    
    const fileName = `${fullName.replace(/\s+/g, '_')}_Resume.pdf`;
    doc.save(fileName);
    
    showToast('Professional resume downloaded as PDF!', 'success');
}

function generateProfessionalResume(doc, fullName, email, phone, address, summary, skills, experience, education) {
    let yPosition = 20;
    
    // Header with background
    doc.setFillColor(67, 97, 238);
    doc.rect(0, 0, 210, 50, 'F');
    
    // Name
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(24);
    doc.setFont('helvetica', 'bold');
    doc.text(fullName.toUpperCase(), 105, 30, { align: 'center' });
    
    // Contact info
    doc.setFontSize(10);
    doc.setFont('helvetica', 'normal');
    const contactInfo = [email, phone, address].filter(Boolean).join(' • ');
    doc.text(contactInfo, 105, 40, { align: 'center' });
    
    yPosition = 60;
    
    // Sections
    const sections = [];
    
    if (summary) {
        sections.push({
            title: 'PROFESSIONAL SUMMARY',
            content: summary,
            type: 'paragraph'
        });
    }
    
    if (skills) {
        sections.push({
            title: 'TECHNICAL SKILLS',
            content: skills.split(',').map(s => s.trim()),
            type: 'list'
        });
    }
    
    if (experience) {
        sections.push({
            title: 'EXPERIENCE',
            content: [`${experience} years of professional experience in software development`],
            type: 'list'
        });
    }
    
    if (education) {
        sections.push({
            title: 'EDUCATION',
            content: education,
            type: 'paragraph'
        });
    }
    
    // Render sections
    sections.forEach(section => {
        if (yPosition > 250) {
            doc.addPage();
            yPosition = 20;
        }
        
        // Section header
        doc.setFillColor(67, 97, 238);
        doc.rect(15, yPosition - 4, 180, 6, 'F');
        
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.text(section.title, 20, yPosition + 1);
        
        yPosition += 10;
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        
        if (section.type === 'paragraph') {
            const lines = doc.splitTextToSize(section.content, 170);
            doc.text(lines, 20, yPosition);
            yPosition += (lines.length * 5) + 10;
        } else if (section.type === 'list') {
            section.content.forEach(item => {
                doc.text(`• ${item}`, 20, yPosition);
                yPosition += 6;
            });
            yPosition += 5;
        }
    });
    
    // Footer
    doc.setFontSize(8);
    doc.setTextColor(128, 128, 128);
    doc.text('Generated by CareerConnect - Professional Resume Builder', 105, 290, { align: 'center' });
}

function generateModernResume(doc, fullName, email, phone, address, summary, skills, experience, education) {
    let yPosition = 20;
    
    // Modern gradient-like header
    doc.setFillColor(86, 98, 246);
    doc.rect(0, 0, 210, 60, 'F');
    
    doc.setFillColor(106, 118, 255);
    doc.rect(0, 30, 210, 30, 'F');
    
    // Name with shadow effect
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(26);
    doc.setFont('helvetica', 'bold');
    doc.text(fullName, 25, 45);
    
    // Contact in sidebar
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    
    let contactY = 80;
    if (email) {
        doc.text(`📧 ${email}`, 25, contactY);
        contactY += 6;
    }
    if (phone) {
        doc.text(`📱 ${phone}`, 25, contactY);
        contactY += 6;
    }
    if (address) {
        doc.text(`📍 ${address}`, 25, contactY);
        contactY += 10;
    }
    
    // Main content
    let mainY = 80;
    doc.setTextColor(0, 0, 0);
    
    if (summary) {
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.text('About Me', 120, mainY);
        mainY += 8;
        
        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        const lines = doc.splitTextToSize(summary, 80);
        doc.text(lines, 120, mainY);
        mainY += (lines.length * 4) + 15;
    }
    
    if (skills) {
        doc.setFontSize(12);
        doc.setFont('helvetica', 'bold');
        doc.text('Skills', 120, mainY);
        mainY += 8;
        
        doc.setFontSize(9);
        const skillsArray = skills.split(',').map(s => s.trim());
        skillsArray.forEach(skill => {
            // Skill badges
            doc.setFillColor(67, 97, 238);
            doc.roundedRect(120, mainY - 3, doc.getTextWidth(skill) + 4, 5, 2, 2, 'F');
            doc.setTextColor(255, 255, 255);
            doc.text(skill, 122, mainY + 1);
            mainY += 8;
        });
        mainY += 10;
    }
    
    // Footer
    doc.setFontSize(8);
    doc.setTextColor(150, 150, 150);
    doc.text('Modern Resume • CareerConnect', 105, 290, { align: 'center' });
}

function generateMinimalResume(doc, fullName, email, phone, address, summary, skills, experience, education) {
    let yPosition = 30;
    
    // Minimal header
    doc.setDrawColor(67, 97, 238);
    doc.setLineWidth(0.5);
    doc.line(20, 25, 190, 25);
    
    // Name
    doc.setTextColor(67, 97, 238);
    doc.setFontSize(20);
    doc.setFont('helvetica', 'bold');
    doc.text(fullName, 105, yPosition, { align: 'center' });
    yPosition += 10;
    
    // Contact
    doc.setFontSize(9);
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(100, 100, 100);
    const contactInfo = [email, phone, address].filter(Boolean).join('  •  ');
    doc.text(contactInfo, 105, yPosition, { align: 'center' });
    yPosition += 20;
    
    // Content
    doc.setTextColor(0, 0, 0);
    
    if (summary) {
        doc.setFontSize(10);
        doc.setFont('helvetica', 'italic');
        const lines = doc.splitTextToSize(summary, 170);
        doc.text(lines, 20, yPosition);
        yPosition += (lines.length * 4) + 15;
    }
    
    // Two column layout for skills and experience
    const leftX = 20;
    const rightX = 110;
    let leftY = yPosition;
    let rightY = yPosition;
    
    if (skills) {
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.text('Skills', leftX, leftY);
        leftY += 8;
        
        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        skills.split(',').map(s => s.trim()).forEach(skill => {
            doc.text(`• ${skill}`, leftX, leftY);
            leftY += 5;
        });
        leftY += 10;
    }
    
    if (experience) {
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.text('Experience', rightX, rightY);
        rightY += 8;
        
        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        doc.text(`• ${experience} years experience`, rightX, rightY);
        rightY += 15;
    }
    
    if (education) {
        const eduY = Math.max(leftY, rightY) + 10;
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.text('Education', 20, eduY);
        
        doc.setFontSize(9);
        doc.setFont('helvetica', 'normal');
        const eduLines = doc.splitTextToSize(education, 170);
        doc.text(eduLines, 20, eduY + 8);
    }
    
    // Minimal footer
    doc.setFontSize(7);
    doc.setTextColor(200, 200, 200);
    doc.text('CareerConnect', 105, 290, { align: 'center' });
}

// Initialize resume builder when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Add CSS for resume builder
    const style = document.createElement('style');
    style.textContent = `
        .template-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .cursor-pointer {
            cursor: pointer;
        }
        .resume-preview {
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            padding: 20px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
    `;
    document.head.appendChild(style);
    
    // Enhance resume builder after a short delay
    setTimeout(enhanceResumeBuilder, 1000);
});

// Replace the original generateResume function with enhanced version
function generateResume() {
    generateEnhancedPDFResume();
}

// Add this function to show PDF preview (optional)
function showPDFPreview() {
    // This would require a more complex implementation with PDF.js
    showToast('PDF preview feature coming soon!', 'info');
}


//Toastify fix - Add this at the END of your JavaScript code
function showToast(message, type = 'info') {
    // Remove any existing toasts first
    document.querySelectorAll('.toastify').forEach(toast => toast.remove());
    
    const background = type === 'success' ? 'linear-gradient(135deg, #00b09b, #96c93d)' :
                        type === 'error' ? 'linear-gradient(135deg, #ff5f6d, #ffc371)' :
                        type === 'warning' ? 'linear-gradient(135deg, #f46b45, #eea849)' :
                        'linear-gradient(135deg, #4facfe, #00f2fe)';
    
    Toastify({
        text: message,
        duration: 4000,
        gravity: "top",
        position: "right",
        stopOnFocus: true,
        style: {
            background: background,
            borderRadius: '10px',
            boxShadow: '0 5px 15px rgba(0,0,0,0.2)',
            fontFamily: 'Poppins, sans-serif',
            fontWeight: '500',
            fontSize: '14px',
            padding: '15px 20px'
        }
    }).showToast();
}

// Fixed status update function
async function updateApplicationStatus(applicationId, status) {
    try {
        console.log('Updating status for application:', applicationId, 'to:', status);
        
        const formData = new FormData();
        formData.append('applicationId', applicationId);
        formData.append('status', status);
        
        const response = await fetch('/admin/update-application-status', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        console.log('Response:', data);
        
        if (data.success) {
            if (data.emailSent) {
                showToast('✅ Status updated and email sent successfully!', 'success');
            } else {
                showToast('✅ Status updated successfully!', 'success');
            }
            // Reload admin data after 2 seconds
            setTimeout(() => {
                loadAdminData();
            }, 2000);
        } else {
            showToast('❌ ' + data.message, 'error');
        }
    } catch (error) {
        console.error('Update failed:', error);
        showToast('❌ Failed to update status', 'error');
    }
}

// Update the status change handler in admin panel
function handleStatusUpdate(applicationId, newStatus) {
    console.log('Handling status update:', applicationId, newStatus);
    
    // Show confirmation for rejections
    if (newStatus === 'Rejected') {
        if (!confirm('Are you sure you want to reject this application?')) {
            // Reset the select to original value
            event.target.value = event.target.dataset.originalValue;
            return;
        }
    }
    
    // Call the update function
    updateApplicationStatus(applicationId, newStatus);
}

// Test function to check if toasts are working
function testToasts() {
    showToast('This is a success message!', 'success');
    setTimeout(() => showToast('This is an error message!', 'error'), 1000);
    setTimeout(() => showToast('This is a warning message!', 'warning'), 2000);
    setTimeout(() => showToast('This is an info message!', 'info'), 3000);
}

// Call this to test if toasts work
console.log('Toast functions loaded - ready to use!');

// Add this button to your admin panel HTML for testing:
// <button class="btn btn-sm btn-info" onclick="testToasts()">Test Toasts</button> 










    </script>
</body>
</html>